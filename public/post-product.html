<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="‡∏•‡∏á‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ WiT Marketplace - ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ü‡∏£‡∏µ">
    <title>‡∏•‡∏á‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - WiT Marketplace</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #FF5722;
            --primary-dark: #E64A19;
            --secondary: #2196F3;
            --success: #4CAF50;
            --warning: #FF9800;
            --dark: #212121;
            --light: #FAFAFA;
            --gray: #757575;
            --border: #E0E0E0;
            --line-green: #00C300;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Kanit', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
            min-height: 100vh;
            color: var(--dark);
        }
        
        /* AI Data Badge */
        .ai-data-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .ai-data-badge i {
            font-size: 1.2rem;
        }
        
        .ai-data-badge span {
            flex: 1;
        }
        
        .ai-data-badge button {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
        }
        
        /* Login Required Modal */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
        }
        
        .login-modal.show {
            display: flex;
        }
        
        .login-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 400px;
            text-align: center;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .login-card .icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #00C300 0%, #00A300 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }
        
        .login-card .icon i {
            font-size: 2.5rem;
            color: white;
        }
        
        .login-card h3 {
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .login-card p {
            color: var(--gray);
            margin-bottom: 25px;
        }
        
        .btn-line-login {
            background: linear-gradient(135deg, #00C300 0%, #00A300 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }
        
        .btn-line-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,195,0,0.4);
            color: white;
        }
        
        .btn-line-login i {
            font-size: 1.3rem;
        }
        
        /* User Badge (Logged in) */
        .user-badge {
            background: linear-gradient(135deg, #00C300 0%, #00A300 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .user-badge img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid white;
        }
        
        .user-badge .user-info {
            flex: 1;
        }
        
        .user-badge .user-name {
            font-weight: 600;
        }
        
        .user-badge .user-status {
            font-size: 0.85rem;
            opacity: 0.9;
        }
        
        /* Toast Notification */
        .toast-notification {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #333;
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: 500;
            z-index: 3000;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .toast-notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        
        .toast-notification.success {
            background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            text-decoration: none;
            color: white;
        }
        
        .logo:hover {
            color: #FFE0B2;
        }
        
        .nav-link-header {
            color: white;
            margin-left: 20px;
            text-decoration: none;
            font-weight: 500;
        }
        
        .nav-link-header:hover {
            color: #FFE0B2;
        }
        
        /* Main Content */
        .main-content {
            padding: 30px 0 60px;
        }
        
        .form-container {
            max-width: 700px;
            margin: 0 auto;
        }
        
        .form-card {
            background: white;
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .form-title {
            font-size: 1.8rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .form-subtitle {
            text-align: center;
            color: var(--gray);
            margin-bottom: 30px;
        }
        
        /* Image Upload */
        .image-upload-area {
            border: 3px dashed var(--border);
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--light);
            margin-bottom: 25px;
        }
        
        .image-upload-area:hover {
            border-color: var(--primary);
            background: #FFF3E0;
        }
        
        .image-upload-area.dragover {
            border-color: var(--primary);
            background: #FFCCBC;
        }
        
        .image-upload-area.has-image {
            padding: 15px;
            border-style: solid;
            border-color: var(--success);
        }
        
        .upload-icon {
            font-size: 3rem;
            color: var(--gray);
            margin-bottom: 15px;
        }
        
        .image-upload-area:hover .upload-icon {
            color: var(--primary);
        }
        
        .upload-text {
            color: var(--gray);
            font-size: 1rem;
        }
        
        .upload-hint {
            color: #BDBDBD;
            font-size: 0.85rem;
            margin-top: 10px;
        }
        
        #imagePreview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 10px;
            display: none;
        }
        
        .remove-image {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(244, 67, 54, 0.9);
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .preview-container {
            position: relative;
            display: inline-block;
        }
        
        /* Form Fields */
        .form-label {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
        }
        
        .form-label .required {
            color: #F44336;
        }
        
        .form-control {
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 14px 18px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 87, 34, 0.1);
        }
        
        .form-control::placeholder {
            color: #BDBDBD;
        }
        
        .input-group-text {
            background: var(--light);
            border: 2px solid var(--border);
            border-right: none;
            border-radius: 12px 0 0 12px;
            padding: 14px 18px;
            color: var(--gray);
        }
        
        .input-group .form-control {
            border-radius: 0 12px 12px 0;
        }
        
        /* Category Select */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 25px;
        }
        
        .category-btn {
            padding: 12px 10px;
            border: 2px solid var(--border);
            border-radius: 10px;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .category-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .category-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .category-btn i {
            display: block;
            font-size: 1.3rem;
            margin-bottom: 5px;
        }
        
        /* Contact Section */
        .contact-section {
            background: #E3F2FD;
            border-radius: 15px;
            padding: 20px;
            margin: 25px 0;
        }
        
        .contact-section h5 {
            color: #1976D2;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        /* Submit Button */
        .btn-submit {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }
        
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 87, 34, 0.3);
        }
        
        .btn-submit:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* LINE Login Notice */
        .line-notice {
            background: linear-gradient(135deg, var(--line-green) 0%, #00A000 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .line-notice i {
            font-size: 2rem;
        }
        
        .line-notice-text h6 {
            margin: 0 0 5px;
            font-weight: 600;
        }
        
        .line-notice-text p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* Success Modal */
        .success-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .success-modal.show {
            display: flex;
        }
        
        .success-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            margin: 20px;
            animation: popIn 0.3s ease;
        }
        
        @keyframes popIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
            background: var(--success);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2.5rem;
        }
        
        .success-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .success-message {
            color: var(--gray);
            margin-bottom: 25px;
        }
        
        .btn-line-chat {
            background: var(--line-green);
            color: white;
            padding: 15px 30px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .btn-line-chat:hover {
            background: #00A000;
            color: white;
            transform: scale(1.05);
        }
        
        /* Footer */
        .footer {
            background: var(--dark);
            color: white;
            padding: 30px 0;
            text-align: center;
        }
        
        .footer a {
            color: #FFD740;
            text-decoration: none;
        }
        
        /* Loading Overlay */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.9);
            z-index: 3000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        .loading-overlay.show {
            display: flex;
        }
        
        .spinner-large {
            width: 60px;
            height: 60px;
            border: 5px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            margin-top: 20px;
            font-size: 1.1rem;
            color: var(--gray);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .form-card {
                padding: 25px 20px;
                border-radius: 15px;
            }
            
            .category-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .form-title {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <a href="marketplace.html" class="logo">
                    <i class="fas fa-store"></i> WiT Marketplace
                </a>
                <nav>
                    <a href="marketplace.html" class="nav-link-header">
                        <i class="fas fa-shopping-bag"></i> ‡∏ï‡∏•‡∏≤‡∏î
                    </a>
                    <a href="marketplace-howto.html" class="nav-link-header">
                        <i class="fas fa-question-circle"></i> ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <div class="form-container">
                <div class="form-card">
                    <h1 class="form-title">üì¶ ‡∏•‡∏á‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
                    <p class="form-subtitle">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏á‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!</p>
                    
                    <!-- LINE Notice -->
                    <div class="line-notice">
                        <i class="fab fa-line"></i>
                        <div class="line-notice-text">
                            <h6>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö LINE OA</h6>
                            <p>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ï‡∏•‡∏≤‡∏î ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ñ‡∏ô‡∏™‡∏ô‡πÉ‡∏à</p>
                        </div>
                    </div>
                    
                    <form id="postProductForm">
                        <!-- Image Upload -->
                        <div class="mb-4">
                            <label class="form-label">
                                <i class="fas fa-camera"></i> ‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ <span class="required">*</span>
                            </label>
                            <div class="image-upload-area" id="imageUploadArea">
                                <div id="uploadPlaceholder">
                                    <div class="upload-icon">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                    </div>
                                    <div class="upload-text">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</div>
                                    <div class="upload-hint">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö JPG, PNG ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB</div>
                                </div>
                                <div class="preview-container" id="previewContainer" style="display: none;">
                                    <img id="imagePreview" alt="Preview">
                                    <button type="button" class="remove-image" onclick="removeImage()">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <input type="file" id="imageInput" accept="image/*" hidden>
                        </div>
                        
                        <!-- Product Name -->
                        <div class="mb-4">
                            <label class="form-label">
                                <i class="fas fa-tag"></i> ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ <span class="required">*</span>
                            </label>
                            <input type="text" class="form-control" id="productName" 
                                   placeholder="‡πÄ‡∏ä‡πà‡∏ô iPhone 14 Pro Max 256GB ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á" required maxlength="100">
                        </div>
                        
                        <!-- Price -->
                        <div class="mb-4">
                            <label class="form-label">
                                <i class="fas fa-money-bill-wave"></i> ‡∏£‡∏≤‡∏Ñ‡∏≤ <span class="required">*</span>
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">‡∏ø</span>
                                <input type="number" class="form-control" id="productPrice" 
                                       placeholder="0" required min="1" max="9999999">
                            </div>
                        </div>
                        
                        <!-- Category -->
                        <div class="mb-4">
                            <label class="form-label">
                                <i class="fas fa-folder"></i> ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà <span class="required">*</span>
                            </label>
                            <div class="category-grid">
                                <div class="category-btn" data-category="electronics">
                                    <i class="fas fa-laptop"></i>
                                    ‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå
                                </div>
                                <div class="category-btn" data-category="fashion">
                                    <i class="fas fa-tshirt"></i>
                                    ‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô
                                </div>
                                <div class="category-btn" data-category="home">
                                    <i class="fas fa-home"></i>
                                    ‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô
                                </div>
                                <div class="category-btn" data-category="beauty">
                                    <i class="fas fa-spa"></i>
                                    ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡∏≤‡∏°
                                </div>
                                <div class="category-btn" data-category="sports">
                                    <i class="fas fa-running"></i>
                                    ‡∏Å‡∏µ‡∏¨‡∏≤
                                </div>
                                <div class="category-btn" data-category="other">
                                    <i class="fas fa-ellipsis-h"></i>
                                    ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                                </div>
                            </div>
                            <input type="hidden" id="productCategory" required>
                        </div>
                        
                        <!-- Description -->
                        <div class="mb-4">
                            <label class="form-label">
                                <i class="fas fa-align-left"></i> ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                            </label>
                            <textarea class="form-control" id="productDescription" rows="4" 
                                      placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ, ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢ ‡∏Ø‡∏•‡∏Ø" maxlength="500"></textarea>
                        </div>
                        
                        <!-- Contact Section -->
                        <div class="contact-section">
                            <h5><i class="fas fa-address-book"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h5>
                            
                            <!-- Seller Name -->
                            <div class="mb-3">
                                <label class="form-label">
                                    ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ <span class="required">*</span>
                                </label>
                                <input type="text" class="form-control" id="sellerName" 
                                       placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á" required maxlength="50">
                            </div>
                            
                            <!-- Phone -->
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-phone"></i> ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå
                                </label>
                                <input type="tel" class="form-control" id="sellerPhone" 
                                       placeholder="08x-xxx-xxxx" pattern="[0-9]{9,10}">
                            </div>
                            
                            <!-- LINE ID -->
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fab fa-line"></i> LINE ID
                                </label>
                                <input type="text" class="form-control" id="sellerLineId" 
                                       placeholder="@yourlineid ‡∏´‡∏£‡∏∑‡∏≠ phone number">
                            </div>
                            
                            <!-- Location -->
                            <div class="mb-0">
                                <label class="form-label">
                                    <i class="fas fa-map-marker-alt"></i> ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà/‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
                                </label>
                                <input type="text" class="form-control" id="sellerLocation" 
                                       placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø, ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà">
                            </div>
                        </div>
                        
                        <!-- Terms -->
                        <div class="form-check mb-4">
                            <input class="form-check-input" type="checkbox" id="agreeTerms" required>
                            <label class="form-check-label" for="agreeTerms">
                                ‡∏â‡∏±‡∏ô‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö <a href="terms.html" target="_blank">‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</a> 
                                ‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏ú‡∏¥‡∏î‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢
                            </label>
                        </div>
                        
                        <!-- Submit Button -->
                        <button type="submit" class="btn-submit" id="submitBtn">
                            <i class="fas fa-paper-plane"></i> ‡∏•‡∏á‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏•‡∏¢!
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Success Modal -->
    <div class="success-modal" id="successModal">
        <div class="success-content">
            <div class="success-icon">
                <i class="fas fa-check"></i>
            </div>
            <h2 class="success-title">‡∏•‡∏á‡∏Ç‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ</h2>
            <p class="success-message">
                ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ï‡∏•‡∏≤‡∏î‡πÅ‡∏•‡πâ‡∏ß<br>
                ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô LINE OA ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ñ‡∏ô‡∏™‡∏ô‡πÉ‡∏à
            </p>
            <a href="https://line.me/R/ti/p/@563eikqn" target="_blank" class="btn-line-chat">
                <i class="fab fa-line"></i>
                ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô LINE OA
            </a>
            <div class="mt-3">
                <a href="marketplace.html" class="text-muted">‡∏î‡∏π‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏•‡∏≤‡∏î ‚Üí</a>
            </div>
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner-large"></div>
        <div class="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...</div>
    </div>
    
    <!-- Login Required Modal -->
    <div class="login-modal" id="loginModal">
        <div class="login-card">
            <div class="icon">
                <i class="fab fa-line"></i>
            </div>
            <h3>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
            <p>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏á‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô Marketplace<br>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô LINE OA ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏∞</p>
            <a href="https://line.me/R/ti/p/@563eikqn" target="_blank" class="btn-line-login" rel="noopener">
                <i class="fab fa-line"></i>
                ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô LINE OA
            </a>
            <div class="mt-3">
                <small class="text-muted">‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏™‡πà‡∏á /‡πÇ‡∏û‡∏™‡∏ï‡πå ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ç‡∏≤‡∏¢</small>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>
                <a href="marketplace.html">‡∏ï‡∏•‡∏≤‡∏î</a> | 
                <a href="marketplace-howto.html">‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ</a> | 
                <a href="terms.html">‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</a>
            </p>
            <p class="mt-2 text-muted">¬© 2025 WiT Marketplace by Wizmobiz</p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD92Lw0vd32ce6m4J2nBVBWZRYBy4aDB_s",
            authDomain: "appinjproject.firebaseapp.com",
            projectId: "appinjproject",
            storageBucket: "appinjproject.firebasestorage.app",
            messagingSenderId: "408718656984",
            appId: "1:408718656984:web:76e9cc7a89e9b4c9d5a8ab"
        };

        // API Base URL
        const API_BASE_URL = 'https://us-central1-appinjproject.cloudfunctions.net';

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
        const auth = firebase.auth();

        // State
        let selectedImage = null;
        let selectedCategory = '';
        let aiData = null;
        let lineUserId = null;
        let currentUser = null;
        let idToken = null;

        // Check authentication on page load
        async function checkAuthentication() {
            const urlParams = new URLSearchParams(window.location.search);
            const lineUserIdParam = urlParams.get('lineUserId');
            const aidataParam = urlParams.get('aidata');
            
            // Priority 1: Get lineUserId from URL parameter
            if (lineUserIdParam) {
                lineUserId = lineUserIdParam;
                sessionStorage.setItem('lineUserId', lineUserId);
            }
            
            // Priority 2: Get from AI data
            if (!lineUserId && aidataParam) {
                try {
                    const decoded = JSON.parse(decodeURIComponent(atob(aidataParam)));
                    if (decoded.lineUserId) {
                        lineUserId = decoded.lineUserId;
                        sessionStorage.setItem('lineUserId', lineUserId);
                    }
                } catch (e) {
                    console.error('Error parsing aidata:', e);
                }
            }
            
            // Priority 3: Get from sessionStorage
            if (!lineUserId) {
                lineUserId = sessionStorage.getItem('lineUserId');
            }
            
            console.log('üîê Checking authentication, lineUserId:', lineUserId);
            
            if (!lineUserId) {
                // No LINE user ID - show login modal
                showLoginModal();
                return false;
            }
            
            // Show loading state
            showToast('üîê ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...', 'info');
            
            try {
                // Get custom token from backend
                const response = await fetch(`${API_BASE_URL}/marketplaceLineAuth`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ lineUserId })
                });
                
                const result = await response.json();
                console.log('üîê Auth response:', result);
                
                if (!result.success) {
                    console.error('Auth failed:', result.error);
                    if (result.requireAddFriend) {
                        showLoginModal();
                    } else {
                        showToast('‚ùå ' + (result.error || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'), 'error');
                    }
                    return false;
                }
                
                // Sign in with custom token
                await auth.signInWithCustomToken(result.customToken);
                currentUser = result.user;
                
                // Get ID token for API calls
                idToken = await auth.currentUser.getIdToken();
                
                console.log('‚úÖ Logged in as:', currentUser.displayName);
                showUserBadge(currentUser);
                showToast(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${currentUser.displayName}!`, 'success');
                
                return true;
            } catch (error) {
                console.error('Auth error:', error);
                showLoginModal();
                return false;
            }
        }
        
        // Show user badge when logged in
        function showUserBadge(user) {
            const formCard = document.querySelector('.form-card');
            const existingBadge = document.querySelector('.user-badge');
            if (existingBadge) existingBadge.remove();
            
            const badge = document.createElement('div');
            badge.className = 'user-badge';
            badge.innerHTML = `
                <img src="${user.pictureUrl || 'https://via.placeholder.com/40'}" alt="${user.displayName}">
                <div class="user-info">
                    <div class="user-name">${user.displayName}</div>
                    <div class="user-status">${user.isPremium ? '‚≠ê Premium' : `‡∏ü‡∏£‡∏µ ${user.aiPostUsage}/${user.aiPostLimit} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`}</div>
                </div>
            `;
            formCard.insertBefore(badge, formCard.firstChild);
        }
        
        // Show login modal
        function showLoginModal() {
            document.getElementById('loginModal').classList.add('show');
        }
        
        // Hide login modal
        function hideLoginModal() {
            document.getElementById('loginModal').classList.remove('show');
        }

        // Check for AI data from URL parameter
        function checkAIData() {
            const urlParams = new URLSearchParams(window.location.search);
            const aidataParam = urlParams.get('aidata');
            
            if (aidataParam) {
                try {
                    aiData = JSON.parse(decodeURIComponent(atob(aidataParam)));
                    console.log('üì± Received AI data:', aiData);
                    
                    // Store lineUserId
                    if (aiData.lineUserId) {
                        lineUserId = aiData.lineUserId;
                    }
                    
                    // Auto-fill form with AI data
                    fillFormWithAIData(aiData);
                    
                    // Show success toast
                    showToast('‚ú® ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å AI ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß!', 'success');
                    
                    // Clean URL
                    window.history.replaceState({}, document.title, window.location.pathname);
                    
                } catch (error) {
                    console.error('Error parsing AI data:', error);
                }
            }
        }
        
        // Fill form with AI generated data
        function fillFormWithAIData(data) {
            // Fill product name
            if (data.productName) {
                document.getElementById('productName').value = data.productName;
            }
            
            // Fill price
            if (data.price) {
                document.getElementById('productPrice').value = data.price;
            }
            
            // Fill description
            if (data.description) {
                document.getElementById('productDescription').value = data.description;
            }
            
            // Select category
            if (data.category) {
                const categoryBtn = document.querySelector(`.category-btn[data-category="${data.category}"]`);
                if (categoryBtn) {
                    categoryBtn.click();
                } else {
                    // Try to find matching category
                    const otherBtn = document.querySelector('.category-btn[data-category="other"]');
                    if (otherBtn) otherBtn.click();
                }
            }
            
            // Show AI badge
            showAIBadge();
        }
        
        // Show AI data badge
        function showAIBadge() {
            const formCard = document.querySelector('.form-card');
            const existingBadge = document.querySelector('.ai-data-badge');
            if (existingBadge) existingBadge.remove();
            
            const badge = document.createElement('div');
            badge.className = 'ai-data-badge';
            badge.innerHTML = `
                <i class="fas fa-robot"></i>
                <span>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å AI ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå</span>
                <button type="button" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            formCard.insertBefore(badge, formCard.firstChild);
        }
        
        // Show toast notification
        function showToast(message, type = 'default') {
            let toast = document.getElementById('toast');
            if (!toast) {
                toast = document.createElement('div');
                toast.id = 'toast';
                toast.className = 'toast-notification';
                document.body.appendChild(toast);
            }
            
            toast.textContent = message;
            toast.className = 'toast-notification show';
            if (type === 'success') toast.classList.add('success');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // Initialize on page load
        async function initialize() {
            // First check authentication
            await checkAuthentication();
            
            // Then check for AI data
            checkAIData();
        }
        
        // Call initialize on load
        initialize();

        // Elements
        const imageUploadArea = document.getElementById('imageUploadArea');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const previewContainer = document.getElementById('previewContainer');
        const uploadPlaceholder = document.getElementById('uploadPlaceholder');
        const form = document.getElementById('postProductForm');
        const submitBtn = document.getElementById('submitBtn');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const successModal = document.getElementById('successModal');

        // Image Upload Handlers
        imageUploadArea.addEventListener('click', () => imageInput.click());
        
        imageUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            imageUploadArea.classList.add('dragover');
        });
        
        imageUploadArea.addEventListener('dragleave', () => {
            imageUploadArea.classList.remove('dragover');
        });
        
        imageUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            imageUploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                handleImageSelect(file);
            }
        });
        
        imageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                handleImageSelect(file);
            }
        });

        function handleImageSelect(file) {
            // Validate file size (5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB');
                return;
            }
            
            selectedImage = file;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block';
                previewContainer.style.display = 'inline-block';
                uploadPlaceholder.style.display = 'none';
                imageUploadArea.classList.add('has-image');
            };
            reader.readAsDataURL(file);
        }

        function removeImage() {
            selectedImage = null;
            imageInput.value = '';
            imagePreview.src = '';
            imagePreview.style.display = 'none';
            previewContainer.style.display = 'none';
            uploadPlaceholder.style.display = 'block';
            imageUploadArea.classList.remove('has-image');
        }

        // Category Selection
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedCategory = btn.dataset.category;
                document.getElementById('productCategory').value = selectedCategory;
            });
        });

        // Form Submit
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Check if logged in
            if (!auth.currentUser || !idToken) {
                showLoginModal();
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', 'error');
                return;
            }
            
            // Validate
            if (!selectedImage) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
                return;
            }
            
            if (!selectedCategory) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
                return;
            }
            
            // Get form data
            const productName = document.getElementById('productName').value.trim();
            const price = parseInt(document.getElementById('productPrice').value);
            const description = document.getElementById('productDescription').value.trim();
            const sellerName = document.getElementById('sellerName').value.trim();
            const sellerPhone = document.getElementById('sellerPhone').value.trim();
            const sellerLineId = document.getElementById('sellerLineId').value.trim();
            const sellerLocation = document.getElementById('sellerLocation').value.trim();
            
            // Show loading
            loadingOverlay.classList.add('show');
            submitBtn.disabled = true;
            
            try {
                // Convert image to base64
                const reader = new FileReader();
                const imageBase64 = await new Promise((resolve, reject) => {
                    reader.onload = () => resolve(reader.result.split(',')[1]);
                    reader.onerror = reject;
                    reader.readAsDataURL(selectedImage);
                });
                
                // Generate tags
                const tags = generateTags(productName, selectedCategory);
                
                // Post via API
                const response = await fetch(`${API_BASE_URL}/marketplacePostProduct`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${idToken}`
                    },
                    body: JSON.stringify({
                        productData: {
                            productName,
                            price,
                            description,
                            category: selectedCategory,
                            tags,
                            sellerName,
                            sellerPhone,
                            sellerLineId,
                            sellerLocation
                        },
                        imageBase64
                    })
                });
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to post product');
                }
                
                // Hide loading, show success
                loadingOverlay.classList.remove('show');
                successModal.classList.add('show');
                
                // Reset form
                form.reset();
                removeImage();
                document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                selectedCategory = '';
                
            } catch (error) {
                console.error('Error posting product:', error);
                loadingOverlay.classList.remove('show');
                submitBtn.disabled = false;
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            }
        });

        // Generate tags from product name and category
        function generateTags(productName, category) {
            const tags = [category];
            
            // Split product name into words
            const words = productName.toLowerCase()
                .replace(/[^a-zA-Z‡∏Å-‡πô0-9\s]/g, '')
                .split(/\s+/)
                .filter(w => w.length > 1);
            
            // Add unique words as tags (max 5)
            const uniqueWords = [...new Set(words)];
            tags.push(...uniqueWords.slice(0, 5));
            
            return tags;
        }

        // Close success modal when clicking outside
        successModal.addEventListener('click', (e) => {
            if (e.target === successModal) {
                successModal.classList.remove('show');
                submitBtn.disabled = false;
            }
        });

        // Phone number formatting
        document.getElementById('sellerPhone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 10) value = value.slice(0, 10);
            e.target.value = value;
        });
    </script>
</body>
</html>
