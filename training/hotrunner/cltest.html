<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á - Enhanced Injection Molding Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2d3748;
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .card h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.3rem;
            text-align: center;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #4a5568;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .form-group input,
        .form-group select {
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }

        .form-group input.error {
            border-color: #f56565;
            background-color: #fed7d7;
        }

        .form-group input.result {
            color: #e53e3e;
            font-weight: bold;
            background: linear-gradient(135deg, #fed7e2 0%, #fbb6ce 100%);
        }

        .recommended-value {
            font-size: 0.8rem;
            color: #666;
            margin-top: 3px;
            font-style: italic;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #3182ce 0%, #2b6cb0 100%);
        }

        .results-panel {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid #667eea;
        }

        .results-panel h4 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
        }

        .result-item strong {
            color: #667eea;
        }

        .machine-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .phase-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .phase-input label {
            min-width: 80px;
            font-weight: 600;
            color: #4a5568;
        }

        .temperature-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-weight: 600;
        }

        .alert-success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #68d391;
        }

        .alert-warning {
            background: #fefcbf;
            color: #744210;
            border: 1px solid #f6e05e;
        }

        .alert-danger {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #fc8181;
        }

        .alert-info {
            background: #bee3f8;
            color: #2a4365;
            border: 1px solid #63b3ed;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.5s ease;
        }

        .chart-container {
            width: 100%;
            height: 300px;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            padding: 15px;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 20px;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            color: #718096;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .simulation-log {
            max-height: 400px;
            overflow-y: auto;
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-entry.success {
            color: #68d391;
        }

        .log-entry.warning {
            color: #fbd38d;
        }

        .log-entry.error {
            color: #fc8181;
        }

        .tooltip {
            position: relative;
            display: inline-flex;
            align-items: center;
            cursor: help;
        }

        .tooltip-icon {
            width: 16px;
            height: 16px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-left: 5px;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #2d3748;
            color: #fff;
            text-align: left;
            border-radius: 8px;
            padding: 10px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            line-height: 1.4;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .profile-manager {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .profile-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .comparison-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .cost-analysis {
            background: linear-gradient(135deg, #f0fff4 0%, #e6fffa 100%);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .cost-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .machine-animation {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            margin: 20px 0;
        }

        .injection-cycle {
            position: absolute;
            width: 80%;
            height: 60%;
            top: 20%;
            left: 10%;
            background: #667eea;
            border-radius: 10px;
            opacity: 0.1;
            transition: all 0.5s ease;
        }

        .injection-cycle.active {
            opacity: 0.8;
            transform: scale(1.1);
        }

        .defect-prediction {
            background: #fff5f5;
            border-left: 4px solid #f56565;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
        }

        .quality-meter {
            width: 100%;
            height: 30px;
            background: #e2e8f0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            margin: 10px 0;
        }

        .quality-fill {
            height: 100%;
            transition: all 0.5s ease;
            border-radius: 15px;
        }

        .quality-excellent { background: linear-gradient(90deg, #48bb78 0%, #38a169 100%); }
        .quality-good { background: linear-gradient(90deg, #ed8936 0%, #dd6b20 100%); }
        .quality-poor { background: linear-gradient(90deg, #f56565 0%, #e53e3e 100%); }

        .environmental-impact {
            background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .machine-info {
                flex-direction: column;
            }
            
            .temperature-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .tabs {
                overflow-x: auto;
            }

            .comparison-panel {
                grid-template-columns: 1fr;
            }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .btn:active {
            animation: pulse 0.2s ease-in-out;
        }
        
        .form-group input:focus {
            animation: pulse 0.3s ease-in-out;
        }
        
        .result-item {
            transition: all 0.3s ease;
        }
        
        .result-item:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateX(5px);
        }

        @keyframes fillAnimation {
            0% { width: 0%; }
            100% { width: var(--target-width); }
        }

        .animated-fill {
            animation: fillAnimation 1s ease-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè≠ ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á</h1>
            <p>Enhanced Injection Molding Simulation & Analysis Tool v2.0</p>
        </div>

        <!-- Profile Management -->
        <div class="card">
            <h3>üë§ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</h3>
            <div class="profile-manager">
                <div class="profile-buttons">
                    <input type="text" id="profileName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå" style="flex: 1; min-width: 200px;">
                    <button class="btn btn-success" onclick="saveProfile()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</button>
                    <select id="profileSelect" onchange="loadProfile()" style="min-width: 200px;">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</option>
                    </select>
                    <button class="btn btn-warning" onclick="deleteProfile()">üóëÔ∏è ‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</button>
                </div>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('basic')">‚öôÔ∏è ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</button>
            <button class="tab" onclick="switchTab('advanced')">üî¨ ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á</button>
            <button class="tab" onclick="switchTab('analysis')">üìä ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡∏•</button>
            <button class="tab" onclick="switchTab('comparison')">‚öñÔ∏è ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ú‡∏•</button>
            <button class="tab" onclick="switchTab('cost')">üí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</button>
            <button class="tab" onclick="switchTab('report')">üìã ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•</button>
        </div>

        <!-- Basic Parameters Tab -->
        <div id="basic" class="tab-content active">
            <!-- Machine & Material Selection -->
            <div class="card">
                <h3>üîß ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</h3>
                <div class="machine-info">
                    <div class="form-group">
                        <label for="machineSize" class="tooltip">
                            ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡∏ï‡∏±‡∏ô)
                            <span class="tooltip-icon">?</span>
                            <span class="tooltiptext">‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏£‡∏á‡∏´‡∏ô‡∏µ‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏â‡∏µ‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏î‡πâ</span>
                        </label>
                        <select id="machineSize" onchange="updateMachineInfo()">
                            <option value="30">30 ‡∏ï‡∏±‡∏ô</option>
                            <option value="50">50 ‡∏ï‡∏±‡∏ô</option>
                            <option value="100">100 ‡∏ï‡∏±‡∏ô</option>
                            <option value="150">150 ‡∏ï‡∏±‡∏ô</option>
                            <option value="200">200 ‡∏ï‡∏±‡∏ô</option>
                            <option value="250">250 ‡∏ï‡∏±‡∏ô</option>
                            <option value="300">300 ‡∏ï‡∏±‡∏ô</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="plasticType" class="tooltip">
                            ‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å
                            <span class="tooltip-icon">?</span>
                            <span class="tooltiptext">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ú‡∏•‡∏¥‡∏ï ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡∏ô‡∏¥‡∏î‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏• ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏´‡∏î‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô</span>
                        </label>
                        <select id="plasticType" onchange="updatePlasticProperties()">
                            <option value="ABS">ABS - ‡∏ó‡∏ô‡∏ó‡∏≤‡∏ô ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á</option>
                            <option value="PP">PP - ‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ñ‡∏π‡∏Å</option>
                            <option value="PE">PE - ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
                            <option value="PS">PS - ‡πÉ‡∏™ ‡πÅ‡∏Ç‡πá‡∏á</option>
                            <option value="PC">PC - ‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á ‡πÉ‡∏™</option>
                            <option value="PA">PA (Nylon) - ‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á ‡∏ó‡∏ô‡πÄ‡∏Ñ‡∏°‡∏µ</option>
                            <option value="POM">POM - ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢‡∏î‡∏™‡∏µ</option>
                            <option value="PMMA">PMMA - ‡πÉ‡∏™‡πÉ‡∏ô ‡∏ó‡∏ô‡∏£‡∏±‡∏á‡∏™‡∏µ UV</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="gateType" class="tooltip">
                            ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó Gate
                            <span class="tooltip-icon">?</span>
                            <span class="tooltiptext">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å ‡∏°‡∏µ‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ú‡∏¥‡∏ß</span>
                        </label>
                        <select id="gateType">
                            <option value="Side Gate">Side Gate - ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏á‡πà‡∏≤‡∏¢</option>
                            <option value="Direct Gate">Direct Gate - ‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•‡∏î‡∏µ</option>
                            <option value="Fan Gate">Fan Gate - ‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô</option>
                            <option value="Pin Gate">Pin Gate - ‡∏£‡∏≠‡∏¢‡πÅ‡∏¢‡∏Å‡πÄ‡∏•‡πá‡∏Å</option>
                            <option value="Submarine Gate">Submarine Gate - ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‡∏Ç‡∏ô‡∏≤‡∏î Screw: <span id="screwSize">20</span> mm</label>
                        <label>Max Shot: <span id="maxShot">0</span> g</label>
                    </div>
                </div>
            </div>

            <!-- Part Weight & Shot Size -->
            <div class="card">
                <h3>‚öñÔ∏è ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞ Shot Size</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="partWeight" class="tooltip">
                            ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô (g) *
                            <span class="tooltip-icon">?</span>
                            <span class="tooltiptext">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï ‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏° Runner ‡πÅ‡∏•‡∏∞ Gate</span>
                        </label>
                        <input type="number" id="partWeight" step="0.1" oninput="calculateShotSize()">
                        <div class="recommended-value">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: 5-500g ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á 100 ‡∏ï‡∏±‡∏ô</div>
                    </div>
                    <div class="form-group">
                        <label for="runnerWeight" class="tooltip">
                            ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å Runner (g)
                            <span class="tooltip-icon">?</span>
                            <span class="tooltiptext">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≤‡∏á‡∏ô‡πâ‡∏≥ (Runner) ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏¥‡πâ‡∏á</span>
                        </label>
                        <input type="number" id="runnerWeight" step="0.1" value="5" oninput="calculateShotSize()">
                        <div class="recommended-value">‡∏õ‡∏Å‡∏ï‡∏¥: 10-30% ‡∏Ç‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô</div>
                    </div>
                    <div class="form-group">
                        <label>Shot Size ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ (mm)</label>
                        <input type="number" id="calculatedShotSize" readonly class="result">
                    </div>
                    <div class="form-group">
                        <label for="actualShotSize" class="tooltip">
                            Shot Size ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á (mm) *
                            <span class="tooltip-icon">?</span>
                            <span class="tooltiptext">‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏Å‡∏£‡∏π‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î</span>
                        </label>
                        <input type="number" id="actualShotSize" step="0.1">
                        <div class="recommended-value">‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ + 5-10mm</div>
                    </div>
                </div>
            </div>

            <!-- Temperature Settings -->
            <div class="card">
                <h3>üå°Ô∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</h3>
                <div class="temperature-grid">
                    <div class="form-group">
                        <label for="tempHN" class="tooltip">
                            Nozzle (¬∞C) *
                            <span class="tooltip-icon">?</span>
                            <span class="tooltiptext">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏ß‡∏â‡∏µ‡∏î ‡∏Ñ‡∏ß‡∏£‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏î‡∏ï‡∏±‡∏ô</span>
                        </label>
                        <input type="number" id="tempHN" step="1">
                        <div class="recommended-value" id="tempHNRec">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: 210¬∞C</div>
                    </div>
                    <div class="form-group">
                        <label for="tempH1" class="tooltip">
                            Zone 1 (¬∞C) *
                            <span class="tooltip-icon">?</span>
                            <span class="tooltiptext">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÇ‡∏ã‡∏ô‡∏ó‡∏µ‡πà 1 (‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏±‡∏ß‡∏â‡∏µ‡∏î) ‡∏Ñ‡∏ß‡∏£‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</span>
                        </label>
                        <input type="number" id="tempH1" step="1">
                        <div class="recommended-value" id="tempH1Rec">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: 220¬∞C</div>
                    </div>
                    <div class="form-group">
                        <label for="tempH2" class="tooltip">
                            Zone 2 (¬∞C) *
                            <span class="tooltip-icon">?</span>
                            <span class="tooltiptext">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÇ‡∏ã‡∏ô‡∏ó‡∏µ‡πà 2 (‡∏Å‡∏•‡∏≤‡∏á)</span>
                        </label>
                        <input type="number" id="tempH2" step="1">
                        <div class="recommended-value" id="tempH2Rec">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: 210¬∞C</div>
                    </div>
                    <div class="form-group">
                        <label for="tempH3" class="tooltip">
                            Zone 3 (¬∞C) *
                            <span class="tooltip-icon">?</span>
                            <span class="tooltiptext">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÇ‡∏ã‡∏ô‡∏ó‡∏µ‡πà 3 (‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏±‡∏á‡∏õ‡πâ‡∏≠‡∏ô) ‡∏Ñ‡∏ß‡∏£‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î</span>
                        </label>
                        <input type="number" id="tempH3" step="1">
                        <div class="recommended-value" id="tempH3Rec">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: 200¬∞C</div>
                    </div>
                </div>
                <div class="form-grid" style="margin-top: 15px;">
                    <div class="form-group">
                        <label for="moldTemp" class="tooltip">
                            ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå (¬∞C)
                            <span class="tooltip-icon">?</span>
                            <span class="tooltiptext">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏Ç‡∏≠‡∏á‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå ‡∏°‡∏µ‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ú‡∏¥‡∏ß‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏´‡∏î‡∏ï‡∏±‡∏ß</span>
                        </label>
                        <input type="number" id="moldTemp" step="1" value="60">
                        <div class="recommended-value">‡∏õ‡∏Å‡∏ï‡∏¥: 40-80¬∞C</div>
                    </div>
                    <div class="form-group">
                        <label for="dryTemp" class="tooltip">
                            ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏≠‡∏ö‡πÅ‡∏´‡πâ‡∏á (¬∞C)
                            <span class="tooltip-icon">?</span>
                            <span class="tooltiptext">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡πÅ‡∏´‡πâ‡∏á‡πÄ‡∏°‡πá‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ</span>
                            </label>
                       <input type="number" id="dryTemp" step="1">
                       <div class="recommended-value" id="dryTempRec">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: 80¬∞C</div>
                   </div>
                   <div class="form-group">
                       <label for="dryTime" class="tooltip">
                           ‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏ö‡πÅ‡∏´‡πâ‡∏á (‡∏ä‡∏°.)
                           <span class="tooltip-icon">?</span>
                           <span class="tooltiptext">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡πÅ‡∏´‡πâ‡∏á‡πÄ‡∏°‡πá‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å</span>
                       </label>
                       <input type="number" id="dryTime" step="0.5">
                       <div class="recommended-value" id="dryTimeRec">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: 2 ‡∏ä‡∏°.</div>
                   </div>
               </div>
           </div>

           <!-- Injection Parameters -->
           <div class="card">
               <h3>üíâ ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î</h3>
               <div class="form-grid">
                   <div class="form-group">
                       <label for="injectionPressure" class="tooltip">
                           ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏â‡∏µ‡∏î (bar) *
                           <span class="tooltip-icon">?</span>
                           <span class="tooltiptext">‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå ‡∏Ñ‡πà‡∏≤‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ñ‡∏£‡∏µ‡∏ö</span>
                       </label>
                       <input type="number" id="injectionPressure" step="1" value="75">
                       <div class="recommended-value">‡∏õ‡∏Å‡∏ï‡∏¥: 50-150 bar</div>
                   </div>
                   <div class="form-group">
                       <label for="injectionSpeed" class="tooltip">
                           ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏â‡∏µ‡∏î (mm/s) *
                           <span class="tooltip-icon">?</span>
                           <span class="tooltiptext">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏™‡∏Å‡∏£‡∏π‡∏Ç‡∏ì‡∏∞‡∏â‡∏µ‡∏î</span>
                       </label>
                       <input type="number" id="injectionSpeed" step="1" value="50">
                       <div class="recommended-value">‡∏õ‡∏Å‡∏ï‡∏¥: 20-100 mm/s</div>
                   </div>
                   <div class="form-group">
                       <label for="injectionTime" class="tooltip">
                           ‡πÄ‡∏ß‡∏•‡∏≤‡∏â‡∏µ‡∏î (s) *
                           <span class="tooltip-icon">?</span>
                           <span class="tooltiptext">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå</span>
                       </label>
                       <input type="number" id="injectionTime" step="0.1" value="2">
                       <div class="recommended-value">‡∏õ‡∏Å‡∏ï‡∏¥: 1-5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</div>
                   </div>
                   <div class="form-group">
                       <label for="holdPressure" class="tooltip">
                           ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏¢‡πâ‡∏≥ (bar) *
                           <span class="tooltip-icon">?</span>
                           <span class="tooltiptext">‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏¢‡πâ‡∏≥‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏î‡πÄ‡∏ä‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏î‡∏ï‡∏±‡∏ß</span>
                       </label>
                       <input type="number" id="holdPressure" step="1" value="50">
                       <div class="recommended-value">‡∏õ‡∏Å‡∏ï‡∏¥: 30-80% ‡∏Ç‡∏≠‡∏á‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏â‡∏µ‡∏î</div>
                   </div>
                   <div class="form-group">
                       <label for="holdTime" class="tooltip">
                           ‡πÄ‡∏ß‡∏•‡∏≤‡∏¢‡πâ‡∏≥ (s) *
                           <span class="tooltip-icon">?</span>
                           <span class="tooltiptext">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏¢‡πâ‡∏≥</span>
                       </label>
                       <input type="number" id="holdTime" step="0.1" value="5">
                       <div class="recommended-value">‡∏õ‡∏Å‡∏ï‡∏¥: 3-10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</div>
                   </div>
                   <div class="form-group">
                       <label for="coolingTime" class="tooltip">
                           ‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏¢‡πá‡∏ô (s) *
                           <span class="tooltip-icon">?</span>
                           <span class="tooltiptext">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏¢‡πá‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡πÅ‡∏Ç‡πá‡∏á‡∏ï‡∏±‡∏ß</span>
                       </label>
                       <input type="number" id="coolingTime" step="0.1" value="20">
                       <div class="recommended-value">‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏Ç‡∏≠‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô</div>
                   </div>
               </div>
           </div>
       </div>

       <!-- Advanced Settings Tab -->
       <div id="advanced" class="tab-content">
           <!-- Multi-Phase Injection -->
           <div class="card">
               <h3>üîÑ ‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î‡πÅ‡∏ö‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏∞‡∏¢‡∏∞ (Multi-Phase Injection)</h3>
               <div id="phaseInputs">
                   <!-- Phase inputs will be generated dynamically -->
               </div>
               <button class="btn btn-success" onclick="addPhase()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞</button>
               <button class="btn btn-warning" onclick="removePhase()">- ‡∏•‡∏î‡∏£‡∏∞‡∏¢‡∏∞</button>
           </div>

           <!-- Screw Parameters -->
           <div class="card">
               <h3>üåÄ ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏™‡∏Å‡∏£‡∏π</h3>
               <div class="form-grid">
                   <div class="form-group">
                       <label for="screwSpeed" class="tooltip">
                           ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏™‡∏Å‡∏£‡∏π (RPM)
                           <span class="tooltip-icon">?</span>
                           <span class="tooltiptext">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏£‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏™‡∏Å‡∏£‡∏π‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏™‡∏°‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å</span>
                       </label>
                       <input type="number" id="screwSpeed" step="1" value="100">
                       <div class="recommended-value">‡∏õ‡∏Å‡∏ï‡∏¥: 50-200 RPM</div>
                   </div>
                   <div class="form-group">
                       <label for="backPressure" class="tooltip">
                           ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡πâ‡∏≤‡∏ô (bar)
                           <span class="tooltip-icon">?</span>
                           <span class="tooltiptext">‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏™‡∏Å‡∏£‡∏π ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏™‡∏°</span>
                       </label>
                       <input type="number" id="backPressure" step="1" value="5">
                       <div class="recommended-value">‡∏õ‡∏Å‡∏ï‡∏¥: 3-15 bar</div>
                   </div>
                   <div class="form-group">
                       <label for="cushion">Cushion (mm)</label>
                       <input type="number" id="cushion" step="0.1" readonly class="result">
                   </div>
                   <div class="form-group">
                       <label for="screwRecoveryTime">‡πÄ‡∏ß‡∏•‡∏≤ Recovery (s)</label>
                       <input type="number" id="screwRecoveryTime" step="0.1" readonly class="result">
                   </div>
               </div>
           </div>

           <!-- Quality Parameters -->
           <div class="card">
               <h3>‚úÖ ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û</h3>
               <div class="form-grid">
                   <div class="form-group">
                       <label for="viscosity" class="tooltip">
                           ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏∑‡∏î (Pa¬∑s)
                           <span class="tooltip-icon">?</span>
                           <span class="tooltiptext">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏∑‡∏î‡∏Ç‡∏≠‡∏á‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏Ç‡∏ì‡∏∞‡∏´‡∏•‡∏≠‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡∏°‡∏µ‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•</span>
                       </label>
                       <input type="number" id="viscosity" step="0.01" value="0.3">
                       <div class="recommended-value">‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å</div>
                   </div>
                   <div class="form-group">
                       <label for="shrinkage" class="tooltip">
                           ‡∏Å‡∏≤‡∏£‡∏´‡∏î‡∏ï‡∏±‡∏ß (%)
                           <span class="tooltip-icon">?</span>
                           <span class="tooltiptext">‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Å‡∏≤‡∏£‡∏´‡∏î‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏Ç‡∏ì‡∏∞‡πÄ‡∏¢‡πá‡∏ô‡∏ï‡∏±‡∏ß</span>
                       </label>
                       <input type="number" id="shrinkage" step="0.01" value="0.5">
                       <div class="recommended-value">‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡∏ô‡∏¥‡∏î‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô</div>
                   </div>
                   <div class="form-group">
                       <label for="gateArea" class="tooltip">
                           ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà Gate (mm¬≤)
                           <span class="tooltip-icon">?</span>
                           <span class="tooltiptext">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏±‡∏î‡∏Ç‡∏≠‡∏á Gate ‡∏°‡∏µ‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•‡πÅ‡∏•‡∏∞‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô</span>
                       </label>
                       <input type="number" id="gateArea" step="0.1" value="2">
                       <div class="recommended-value">‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô</div>
                   </div>
                   <div class="form-group">
                       <label for="flowLength" class="tooltip">
                           ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏• (mm)
                           <span class="tooltip-icon">?</span>
                           <span class="tooltiptext">‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏´‡∏•‡∏à‡∏≤‡∏Å Gate ‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡πÑ‡∏Å‡∏•‡∏™‡∏∏‡∏î</span>
                       </label>
                       <input type="number" id="flowLength" step="1" value="100">
                       <div class="recommended-value">‡∏ß‡∏±‡∏î‡∏à‡∏≤‡∏Å‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏à‡∏£‡∏¥‡∏á</div>
                   </div>
               </div>
           </div>

           <!-- Machine Animation -->
           <div class="card">
               <h3>üé¨ ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</h3>
               <div class="machine-animation" id="machineAnimation">
                   <div class="injection-cycle" id="injectionPhase"></div>
                   <div style="position: absolute; top: 10px; left: 10px; font-weight: bold; color: #667eea;">
                       ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <span id="machineStatus">‡∏û‡∏£‡πâ‡∏≠‡∏°</span>
                   </div>
               </div>
               <div style="text-align: center;">
                   <button class="btn" onclick="startMachineAnimation()">‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏•‡∏≠‡∏á</button>
                   <button class="btn btn-warning" onclick="stopMachineAnimation()">‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î</button>
               </div>
           </div>
       </div>

       <!-- Analysis Tab -->
       <div id="analysis" class="tab-content">
           <!-- Real-time Calculations -->
           <div class="card">
               <h3>‚ö° ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</h3>
               <div class="results-panel">
                   <h4>üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</h4>
                   <div id="calculationResults">
                       <!-- Results will be populated here -->
                   </div>
               </div>
           </div>

           <!-- Quality Analysis with Visual Indicators -->
           <div class="card">
               <h3>üîç ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û</h3>
               <div id="qualityAnalysis">
                   <!-- Quality analysis results -->
               </div>
               <div class="quality-meter">
                   <div class="quality-fill" id="qualityMeter"></div>
               </div>
               <div style="text-align: center; margin-top: 10px;">
                   ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°: <span id="qualityScore">0</span>%
               </div>
           </div>

           <!-- Defect Prediction -->
           <div class="card">
               <h3>‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á</h3>
               <div id="defectPrediction">
                   <!-- Defect predictions will appear here -->
               </div>
           </div>

           <!-- Process Monitoring -->
           <div class="card">
               <h3>üìà ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£</h3>
               <div class="chart-container">
                   <canvas id="processChart" width="400" height="200"></canvas>
               </div>
               <div style="text-align: center; margin-top: 15px;">
                   <button class="btn" onclick="startProcessSimulation()">üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£</button>
                   <button class="btn btn-warning" onclick="pauseSimulation()">‚è∏Ô∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</button>
                   <button class="btn btn-danger" onclick="stopSimulation()">‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î</button>
               </div>
               <div class="progress-bar">
                   <div class="progress-fill" id="processProgress"></div>
               </div>
               <p style="text-align: center; margin-top: 10px;">
                   ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤: <span id="progressText">0%</span>
               </p>
           </div>
       </div>

       <!-- Comparison Tab -->
       <div id="comparison" class="tab-content">
           <div class="card">
               <h3>‚öñÔ∏è ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</h3>
               <div style="margin-bottom: 20px;">
                   <button class="btn btn-info" onclick="captureCurrentResults()">üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</button>
                   <button class="btn btn-warning" onclick="clearComparisons()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</button>
               </div>
               <div class="comparison-panel" id="comparisonPanel">
                   <!-- Comparison results will appear here -->
               </div>
           </div>
       </div>

       <!-- Cost Analysis Tab -->
       <div id="cost" class="tab-content">
           <div class="card">
               <h3>üí∞ ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</h3>
               <div class="cost-analysis" id="costAnalysis">
                   <!-- Cost analysis will be populated here -->
               </div>
               <div class="environmental-impact" id="environmentalImpact">
                   <!-- Environmental impact will be populated here -->
               </div>
               <div style="text-align: center; margin-top: 20px;">
                   <button class="btn btn-success" onclick="calculateCostAnalysis()">üíπ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</button>
               </div>
           </div>
       </div>

       <!-- Report Tab -->
       <div id="report" class="tab-content">
           <!-- Simulation Results -->
           <div class="card">
               <h3>üìã ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á</h3>
               <div class="loading" id="loadingIndicator">
                   <div class="spinner"></div>
                   <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</p>
               </div>
               <div id="simulationReport">
                   <!-- Detailed report will be generated here -->
               </div>
               <div style="text-align: center; margin-top: 20px;">
                   <button class="btn btn-success" onclick="generateReport()">üìä ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
                   <button class="btn" onclick="exportToPDF()">üìÑ Export PDF</button>
                   <button class="btn" onclick="exportToExcel()">üìó Export Excel</button>
               </div>
           </div>

           <!-- Simulation Log -->
           <div class="card">
               <h3>üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á</h3>
               <div class="simulation-log" id="simulationLog">
                   <!-- Log entries will appear here -->
               </div>
               <button class="btn btn-warning" onclick="clearLog()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
           </div>
       </div>

       <!-- Main Action Buttons -->
       <div style="text-align: center; margin: 30px 0;">
           <button class="btn btn-success" onclick="runFullSimulation()">üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</button>
           <button class="btn" onclick="validateInputs()">‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
           <button class="btn btn-info" onclick="showRecommendations()">üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</button>
           <button class="btn btn-warning" onclick="resetAll()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
       </div>
   </div>

   <script>
       // Global variables
       let currentPhases = 3;
       let simulationRunning = false;
       let simulationInterval = null;
       let machineAnimationInterval = null;
       let processChart = null;
       let comparisonData = [];
       let savedProfiles = JSON.parse(localStorage.getItem('injectionMoldingProfiles') || '{}');

       // Enhanced material properties database
       const materialProperties = {
           ABS: {
               temperatures: [210, 220, 210, 200],
               dryTemp: 80,
               dryTime: 2,
               viscosity: 0.3,
               shrinkage: 0.5,
               density: 1.05,
               processWindow: { temp: '200-250¬∞C', pressure: '50-120 bar' },
               applications: '‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á, ‡πÄ‡∏Ñ‡∏™‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå',
               recycleCode: 'ABS',
               cost: 45
           },
           PP: {
               temperatures: [200, 210, 200, 190],
               dryTemp: 60,
               dryTime: 3,
               viscosity: 0.25,
               shrinkage: 1.2,
               density: 0.9,
               processWindow: { temp: '180-220¬∞C', pressure: '40-100 bar' },
               applications: '‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå, ‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå',
               recycleCode: 'PP',
               cost: 35
           },
           PE: {
               temperatures: [180, 190, 180, 170],
               dryTemp: 60,
               dryTime: 2,
               viscosity: 0.2,
               shrinkage: 2.0,
               density: 0.92,
               processWindow: { temp: '160-200¬∞C', pressure: '30-80 bar' },
               applications: '‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏≠‡∏≤‡∏´‡∏≤‡∏£, ‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô',
               recycleCode: 'PE',
               cost: 32
           },
           PS: {
               temperatures: [180, 200, 190, 180],
               dryTemp: 60,
               dryTime: 3.5,
               viscosity: 0.35,
               shrinkage: 0.4,
               density: 1.04,
               processWindow: { temp: '170-210¬∞C', pressure: '40-100 bar' },
               applications: '‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÉ‡∏™, ‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô',
               recycleCode: 'PS',
               cost: 38
           },
           PC: {
               temperatures: [280, 300, 280, 260],
               dryTemp: 120,
               dryTime: 4,
               viscosity: 0.5,
               shrinkage: 0.6,
               density: 1.2,
               processWindow: { temp: '260-320¬∞C', pressure: '60-150 bar' },
               applications: '‡πÄ‡∏•‡∏ô‡∏™‡πå, ‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢',
               recycleCode: 'PC',
               cost: 85
           },
           PA: {
               temperatures: [240, 260, 240, 230],
               dryTemp: 80,
               dryTime: 5,
               viscosity: 0.45,
               shrinkage: 1.0,
               density: 1.14,
               processWindow: { temp: '220-280¬∞C', pressure: '50-130 bar' },
               applications: '‡πÄ‡∏ü‡∏∑‡∏≠‡∏á, ‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏ô‡∏ó‡∏≤‡∏ô',
               recycleCode: 'PA',
               cost: 65
           },
           POM: {
               temperatures: [190, 200, 190, 180],
               dryTemp: 80,
               dryTime: 3,
               viscosity: 0.3,
               shrinkage: 2.0,
               density: 1.41,
               processWindow: { temp: '170-210¬∞C', pressure: '50-120 bar' },
               applications: '‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏•, ‡πÄ‡∏ü‡∏∑‡∏≠‡∏á',
               recycleCode: 'POM',
               cost: 55
           },
           PMMA: {
               temperatures: [230, 250, 230, 220],
               dryTemp: 80,
               dryTime: 3,
               viscosity: 0.4,
               shrinkage: 0.5,
               density: 1.18,
               processWindow: { temp: '210-270¬∞C', pressure: '50-120 bar' },
               applications: '‡πÄ‡∏•‡∏ô‡∏™‡πå, ‡πÅ‡∏ú‡πà‡∏ô‡πÉ‡∏™',
               recycleCode: 'PMMA',
               cost: 48
           }
       };

       // Enhanced machine specifications
       const machineSpecs = {
           30: { screwSize: 20, maxShot: 45, clampForce: 30, power: 15, hourlyRate: 300 },
           50: { screwSize: 25, maxShot: 85, clampForce: 50, power: 25, hourlyRate: 400 },
           100: { screwSize: 30, maxShot: 140, clampForce: 100, power: 40, hourlyRate: 500 },
           150: { screwSize: 35, maxShot: 210, clampForce: 150, power: 55, hourlyRate: 600 },
           200: { screwSize: 40, maxShot: 290, clampForce: 200, power: 70, hourlyRate: 700 },
           250: { screwSize: 45, maxShot: 380, clampForce: 250, power: 85, hourlyRate: 800 },
           300: { screwSize: 50, maxShot: 480, clampForce: 300, power: 100, hourlyRate: 900 }
       };

       // Gate area coefficients
       const gateCoefficients = {
           'Side Gate': 0.5,
           'Direct Gate': 1.0,
           'Fan Gate': 0.7,
           'Pin Gate': 0.4,
           'Submarine Gate': 0.3
       };

       // Initialize application
       document.addEventListener('DOMContentLoaded', function() {
           initializePhaseInputs();
           updateMachineInfo();
           updatePlasticProperties();
           loadProfileOptions();
           logMessage('‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô - Enhanced v2.0', 'success');
       });

       // Profile Management Functions
       function saveProfile() {
           const profileName = document.getElementById('profileName').value.trim();
           if (!profileName) {
               showAlert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå', 'danger');
               return;
           }

           const profileData = {};
           document.querySelectorAll('input, select').forEach(input => {
               if (input.value && input.id) {
                   profileData[input.id] = input.value;
               }
           });

           savedProfiles[profileName] = {
               data: profileData,
               timestamp: new Date().toISOString(),
               description: `${document.getElementById('plasticType').value} - ${document.getElementById('machineSize').value}‡∏ï‡∏±‡∏ô`
           };

           localStorage.setItem('injectionMoldingProfiles', JSON.stringify(savedProfiles));
           loadProfileOptions();
           document.getElementById('profileName').value = '';
           
           showAlert(`‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå "${profileName}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'success');
           logMessage(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå: ${profileName}`, 'success');
       }

       function loadProfile() {
           const profileName = document.getElementById('profileSelect').value;
           if (!profileName || !savedProfiles[profileName]) return;

           const profileData = savedProfiles[profileName].data;
           Object.keys(profileData).forEach(id => {
               const element = document.getElementById(id);
               if (element) {
                   element.value = profileData[id];
               }
           });

           updateMachineInfo();
           updatePlasticProperties();
           calculateShotSize();
           
           showAlert(`‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå "${profileName}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'success');
           logMessage(`‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå: ${profileName}`, 'info');
       }

       function loadProfileOptions() {
           const select = document.getElementById('profileSelect');
           select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</option>';
           
           Object.keys(savedProfiles).forEach(profileName => {
               const option = document.createElement('option');
               option.value = profileName;
               option.textContent = `${profileName} (${savedProfiles[profileName].description})`;
               select.appendChild(option);
           });
       }

       function deleteProfile() {
           const profileName = document.getElementById('profileSelect').value;
           if (!profileName) {
               showAlert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö', 'danger');
               return;
           }

           if (confirm(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå "${profileName}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
               delete savedProfiles[profileName];
               localStorage.setItem('injectionMoldingProfiles', JSON.stringify(savedProfiles));
               loadProfileOptions();
               
               showAlert(`‚úÖ ‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå "${profileName}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'warning');
               logMessage(`‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå: ${profileName}`, 'warning');
           }
       }

       // Tab switching
       function switchTab(tabName) {
           document.querySelectorAll('.tab-content').forEach(content => {
               content.classList.remove('active');
           });
           
           document.querySelectorAll('.tab').forEach(tab => {
               tab.classList.remove('active');
           });
           
           document.getElementById(tabName).classList.add('active');
           event.target.classList.add('active');
           
           // Auto-calculate when switching to analysis tabs
           if (['analysis', 'comparison', 'cost'].includes(tabName)) {
               performCalculations();
           }
           
           logMessage(`‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡πÅ‡∏ó‡πá‡∏ö: ${tabName}`, 'info');
       }

       // Enhanced machine information update
       function updateMachineInfo() {
           const machineSize = document.getElementById('machineSize').value;
           const specs = machineSpecs[machineSize];
           
           document.getElementById('screwSize').textContent = specs.screwSize;
           document.getElementById('maxShot').textContent = specs.maxShot;
           
           document.getElementById('gateArea').value = specs.screwSize * 0.1;
           
           calculateShotSize();
           logMessage(`‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á: ${machineSize} ‡∏ï‡∏±‡∏ô, Screw ${specs.screwSize}mm, Power ${specs.power}kW`, 'info');
       }

       // Enhanced plastic properties update
       function updatePlasticProperties() {
           const plasticType = document.getElementById('plasticType').value;
           const properties = materialProperties[plasticType];
           
           // Update temperatures
           document.getElementById('tempHN').value = properties.temperatures[0];
           document.getElementById('tempH1').value = properties.temperatures[1];
           document.getElementById('tempH2').value = properties.temperatures[2];
           document.getElementById('tempH3').value = properties.temperatures[3];
           
           // Update recommended values display
           document.getElementById('tempHNRec').textContent = `‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${properties.temperatures[0]}¬∞C`;
           document.getElementById('tempH1Rec').textContent = `‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${properties.temperatures[1]}¬∞C`;
           document.getElementById('tempH2Rec').textContent = `‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${properties.temperatures[2]}¬∞C`;
           document.getElementById('tempH3Rec').textContent = `‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${properties.temperatures[3]}¬∞C`;
           
           // Update drying parameters
           document.getElementById('dryTemp').value = properties.dryTemp;
           document.getElementById('dryTime').value = properties.dryTime;
           document.getElementById('dryTempRec').textContent = `‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${properties.dryTemp}¬∞C`;
           document.getElementById('dryTimeRec').textContent = `‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${properties.dryTime} ‡∏ä‡∏°.`;
           
           // Update other properties
           document.getElementById('viscosity').value = properties.viscosity;
           document.getElementById('shrinkage').value = properties.shrinkage;
           
           calculateShotSize();
           logMessage(`‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å: ${plasticType} - ${properties.applications}`, 'info');
       }

       // Enhanced shot size calculation
     function calculateShotSize() {
           const partWeight = parseFloat(document.getElementById('partWeight').value) || 0;
           const runnerWeight = parseFloat(document.getElementById('runnerWeight').value) || 0;
           const plasticType = document.getElementById('plasticType').value;
           const machineSize = document.getElementById('machineSize').value;
           
           const density = materialProperties[plasticType].density;
           const screwSize = machineSpecs[machineSize].screwSize;
           
           if (partWeight > 0) {
               const totalWeight = partWeight + runnerWeight;
               const volume = totalWeight / density; // cm¬≥
               
               // Calculate shot size (screw retraction distance)
               const screwArea = Math.PI * Math.pow(screwSize / 20, 2); // cm¬≤
               const shotSize = volume / screwArea * 10; // Convert to mm
               
               document.getElementById('calculatedShotSize').value = shotSize.toFixed(2);
               document.getElementById('actualShotSize').value = (shotSize * 1.1).toFixed(2); // Add 10% safety margin
               
               // Calculate cushion
               calculateCushion();
               
               // Real-time validation
               const maxShot = machineSpecs[machineSize].maxShot;
               if (totalWeight > maxShot) {
                   showAlert(`‚ö†Ô∏è ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏ß‡∏° (${totalWeight}g) ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (${maxShot}g)`, 'warning');
               }
               
               logMessage(`‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Shot Size: ${shotSize.toFixed(2)} mm ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å ${totalWeight} g`, 'success');
               
               // Auto-update calculations if we're on analysis tab
               if (document.getElementById('analysis').classList.contains('active')) {
                   performCalculations();
               }
           }
       }

       // Enhanced cushion calculation
       function calculateCushion() {
           const actualShotSize = parseFloat(document.getElementById('actualShotSize').value) || 0;
           const holdTime = parseFloat(document.getElementById('holdTime').value) || 0;
           const holdPressure = parseFloat(document.getElementById('holdPressure').value) || 0;
           const plasticType = document.getElementById('plasticType').value;
           
           // Enhanced cushion calculation considering material shrinkage
           const shrinkage = materialProperties[plasticType].shrinkage;
           const cushionFactor = (holdPressure / 100) * (holdTime / 10) * (1 + shrinkage / 100);
           const cushion = actualShotSize * 0.08 + cushionFactor;
           
           document.getElementById('cushion').value = Math.max(cushion, 2).toFixed(2); // Minimum 2mm cushion
       }

       // Initialize phase inputs for multi-phase injection
       function initializePhaseInputs() {
           generatePhaseInputs();
       }

       // Generate phase input fields
       function generatePhaseInputs() {
           const container = document.getElementById('phaseInputs');
           container.innerHTML = '';
           
           for (let i = 1; i <= currentPhases; i++) {
               const phaseDiv = document.createElement('div');
               phaseDiv.className = 'phase-input';
               phaseDiv.innerHTML = `
                   <label>Phase ${i}:</label>
                   <input type="number" placeholder="Position (mm)" id="pos${i}" step="0.1">
                   <input type="number" placeholder="Speed (mm/s)" id="speed${i}" step="1">
                   <input type="number" placeholder="Pressure (bar)" id="pressure${i}" step="1">
               `;
               container.appendChild(phaseDiv);
           }
       }

       // Add injection phase
       function addPhase() {
           if (currentPhases < 10) {
               currentPhases++;
               generatePhaseInputs();
               logMessage(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î: Phase ${currentPhases}`, 'info');
           }
       }

       // Remove injection phase
       function removePhase() {
           if (currentPhases > 1) {
               currentPhases--;
               generatePhaseInputs();
               logMessage(`‡∏•‡∏î‡∏£‡∏∞‡∏¢‡∏∞‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î: Phase ${currentPhases} ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö`, 'warning');
           }
       }

       // Enhanced input validation
       function validateInputs() {
           const requiredFields = [
               'partWeight', 'actualShotSize', 'tempHN', 'tempH1', 'tempH2', 'tempH3',
               'injectionPressure', 'injectionSpeed', 'injectionTime', 
               'holdPressure', 'holdTime', 'coolingTime'
           ];
           
           let isValid = true;
           let missingFields = [];
           let warnings = [];
           
           requiredFields.forEach(fieldId => {
               const field = document.getElementById(fieldId);
               const value = parseFloat(field.value);
               
               if (!value || value <= 0) {
                   field.classList.add('error');
                   missingFields.push(field.previousElementSibling.textContent);
                   isValid = false;
               } else {
                   field.classList.remove('error');
                   
                   // Additional validation rules
                   if (fieldId === 'injectionPressure' && value > 150) {
                       warnings.push('‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏â‡∏µ‡∏î‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ñ‡∏£‡∏µ‡∏ö');
                   }
                   if (fieldId === 'coolingTime' && value < 10) {
                       warnings.push('‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏¢‡πá‡∏ô‡∏™‡∏±‡πâ‡∏ô‡∏°‡∏≤‡∏Å ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ß');
                   }
                   if (fieldId === 'holdPressure' && value > parseFloat(document.getElementById('injectionPressure').value)) {
                       warnings.push('‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏¢‡πâ‡∏≥‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡∏¥‡∏ô‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏â‡∏µ‡∏î');
                   }
               }
           });
           
           if (isValid) {
               let message = '‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!';
               if (warnings.length > 0) {
                   message += '\n‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:\n' + warnings.join('\n');
               }
               showAlert(message, warnings.length > 0 ? 'warning' : 'success');
               logMessage('‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ‡∏ú‡πà‡∏≤‡∏ô' + (warnings.length > 0 ? ` (‡∏°‡∏µ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ${warnings.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)` : ''), 'success');
           } else {
               showAlert(`‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô:\n${missingFields.join(', ')}`, 'danger');
               logMessage(`‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô - ‡∏Ç‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${missingFields.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`, 'error');
           }
           
           return isValid;
       }

       // Enhanced calculations with more parameters
       function performCalculations() {
           const results = {};
           
           // Get input values
           const partWeight = parseFloat(document.getElementById('partWeight').value) || 0;
           const runnerWeight = parseFloat(document.getElementById('runnerWeight').value) || 0;
           const injectionPressure = parseFloat(document.getElementById('injectionPressure').value) || 0;
           const injectionSpeed = parseFloat(document.getElementById('injectionSpeed').value) || 0;
           const injectionTime = parseFloat(document.getElementById('injectionTime').value) || 0;
           const holdPressure = parseFloat(document.getElementById('holdPressure').value) || 0;
           const holdTime = parseFloat(document.getElementById('holdTime').value) || 0;
           const coolingTime = parseFloat(document.getElementById('coolingTime').value) || 0;
           const actualShotSize = parseFloat(document.getElementById('actualShotSize').value) || 0;
           const viscosity = parseFloat(document.getElementById('viscosity').value) || 0;
           const gateArea = parseFloat(document.getElementById('gateArea').value) || 0;
           const flowLength = parseFloat(document.getElementById('flowLength').value) || 0;
           const moldTemp = parseFloat(document.getElementById('moldTemp').value) || 60;
           
           const plasticType = document.getElementById('plasticType').value;
           const machineSize = document.getElementById('machineSize').value;
           const gateType = document.getElementById('gateType').value;
           
           if (partWeight === 0) {
               document.getElementById('calculationResults').innerHTML = '<p style="color: #666;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</p>';
               return null;
           }
           
           // Calculate various parameters
           const totalWeight = partWeight + runnerWeight;
           const density = materialProperties[plasticType].density;
           const shrinkage = materialProperties[plasticType].shrinkage;
           const specs = machineSpecs[machineSize];
           
           // Enhanced flow rate calculation
           results.flowRate = (actualShotSize * Math.PI * Math.pow(specs.screwSize/20, 2)) / injectionTime;
           
           // Enhanced pressure drop calculation considering gate type
           const gateCoeff = gateCoefficients[gateType];
           results.pressureDrop = (8 * viscosity * results.flowRate * flowLength * gateCoeff) / (Math.PI * Math.pow(Math.sqrt(gateArea)/2, 4));
           
           // Mold pressure
           results.moldPressure = Math.max(injectionPressure - results.pressureDrop, 0);
           
           // Filling time calculation
           results.fillingTime = flowLength / (injectionSpeed * 10); // Convert to seconds
           
           // Cycle time
           results.cycleTime = injectionTime + holdTime + coolingTime + 5; // +5s for mold open/close/eject
           
           // Production rate
           results.hourlyProduction = Math.floor(3600 / results.cycleTime);
           
           // Enhanced screw recovery time
           const backPressure = parseFloat(document.getElementById('backPressure').value) || 5;
           const screwSpeed = parseFloat(document.getElementById('screwSpeed').value) || 100;
           results.recoveryTime = (actualShotSize * density) / (screwSpeed * 0.8) * (1 + backPressure/50);
           document.getElementById('screwRecoveryTime').value = results.recoveryTime.toFixed(2);
           
           // Quality predictions
           results.shrinkageAmount = totalWeight * shrinkage / 100;
           results.qualityIndex = calculateQualityIndex(results, moldTemp, plasticType);
           
           // Temperature efficiency
           const avgTemp = (parseFloat(document.getElementById('tempH1').value) + 
                          parseFloat(document.getElementById('tempH2').value) + 
                          parseFloat(document.getElementById('tempH3').value)) / 3;
           const optimalTemp = materialProperties[plasticType].temperatures[1];
           results.tempEfficiency = Math.max(0, 100 - Math.abs(avgTemp - optimalTemp) * 2);
           
           // Energy consumption
           results.energyPerCycle = (specs.power * results.cycleTime) / 3600; // kWh per cycle
           results.dailyEnergy = results.energyPerCycle * results.hourlyProduction * 16; // 16 hours operation
           
           // Update results display
           updateCalculationResults(results);
           updateQualityAnalysis(results);
           updateQualityMeter(results.qualityIndex);
           predictDefects(results);
           
           return results;
       }

       // Enhanced quality index calculation
       function calculateQualityIndex(results, moldTemp, plasticType) {
           let qualityScore = 100;
           
           // Pressure analysis
           if (results.pressureDrop > 80) qualityScore -= 15;
           else if (results.pressureDrop > 50) qualityScore -= 8;
           
           if (results.moldPressure < 20) qualityScore -= 25;
           else if (results.moldPressure < 30) qualityScore -= 10;
           
           // Filling time analysis
           if (results.fillingTime > 5) qualityScore -= 20;
           else if (results.fillingTime > 3) qualityScore -= 10;
           
           // Temperature analysis
           const optimalMoldTemp = plasticType === 'PC' ? 80 : plasticType === 'PA' ? 70 : 60;
           const tempDiff = Math.abs(moldTemp - optimalMoldTemp);
           if (tempDiff > 20) qualityScore -= 15;
           else if (tempDiff > 10) qualityScore -= 8;
           
           // Recovery time analysis
           if (results.recoveryTime > results.cycleTime * 0.8) qualityScore -= 15;
           else if (results.recoveryTime > results.cycleTime * 0.6) qualityScore -= 8;
           
           // Flow analysis
           if (results.flowRate < 1) qualityScore -= 10;
           
           return Math.max(qualityScore, 0);
       }

       // Update calculation results display with enhanced information
       function updateCalculationResults(results) {
           const container = document.getElementById('calculationResults');
           const plasticType = document.getElementById('plasticType').value;
           const properties = materialProperties[plasticType];
           
           container.innerHTML = `
               <div class="result-item">
                   <span>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•:</span>
                   <strong>${results.flowRate.toFixed(2)} cm¬≥/s</strong>
               </div>
               <div class="result-item">
                   <span>‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏ô Gate:</span>
                   <strong style="color: ${results.pressureDrop > 50 ? '#e53e3e' : '#38a169'}">${results.pressureDrop.toFixed(2)} bar</strong>
               </div>
               <div class="result-item">
                   <span>‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÉ‡∏ô‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå:</span>
                   <strong style="color: ${results.moldPressure < 30 ? '#e53e3e' : '#38a169'}">${results.moldPressure.toFixed(2)} bar</strong>
               </div>
               <div class="result-item">
                   <span>‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°:</span>
                   <strong style="color: ${results.fillingTime > 3 ? '#e53e3e' : '#38a169'}">${results.fillingTime.toFixed(2)} s</strong>
               </div>
               <div class="result-item">
                   <span>‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï:</span>
                   <strong>${results.cycleTime.toFixed(1)} s</strong>
               </div>
               <div class="result-item">
                   <span>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï:</span>
                   <strong>${results.hourlyProduction.toFixed(0)} ‡∏ä‡∏¥‡πâ‡∏ô/‡∏ä‡∏°.</strong>
               </div>
               <div class="result-item">
                   <span>‡∏Å‡∏≤‡∏£‡∏´‡∏î‡∏ï‡∏±‡∏ß‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå:</span>
                   <strong>${results.shrinkageAmount.toFixed(2)} g (${properties.shrinkage}%)</strong>
               </div>
               <div class="result-item">
                   <span>‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥:</span>
                   <strong style="color: ${results.tempEfficiency > 80 ? '#38a169' : results.tempEfficiency > 60 ? '#ed8936' : '#e53e3e'}">${results.tempEfficiency.toFixed(1)}%</strong>
               </div>
               <div class="result-item">
                   <span>‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡∏£‡∏≠‡∏ö:</span>
                   <strong>${results.energyPerCycle.toFixed(3)} kWh</strong>
               </div>
               <div class="result-item">
                   <span>‡∏î‡∏±‡∏ä‡∏ô‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°:</span>
                   <strong style="color: ${results.qualityIndex > 80 ? '#38a169' : results.qualityIndex > 60 ? '#ed8936' : '#e53e3e'}">
                       ${results.qualityIndex.toFixed(1)}%
                   </strong>
               </div>
           `;
       }

       // Update quality analysis with detailed recommendations
       function updateQualityAnalysis(results) {
           const container = document.getElementById('qualityAnalysis');
           let analysisHtml = '<h4>üìä ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÇ‡∏î‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h4>';
           
           // Pressure analysis
           if (results.moldPressure < 20) {
               analysisHtml += '<div class="alert alert-danger">‚ö†Ô∏è ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÉ‡∏ô‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡πà‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (< 20 bar) ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°</div>';
           } else if (results.moldPressure > 120) {
               analysisHtml += '<div class="alert alert-warning">‚ö†Ô∏è ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÉ‡∏ô‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (> 120 bar) ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ñ‡∏£‡∏µ‡∏ö</div>';
           } else {
               analysisHtml += '<div class="alert alert-success">‚úÖ ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÉ‡∏ô‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° (20-120 bar)</div>';
           }
           
           // Filling time analysis
           if (results.fillingTime > 5) {
               analysisHtml += '<div class="alert alert-danger">‚ö†Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (> 5s) ‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏≠‡∏≤‡∏à‡πÄ‡∏¢‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏ï‡πá‡∏°</div>';
           } else if (results.fillingTime > 3) {
               analysisHtml += '<div class="alert alert-warning">‚ö†Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≤‡∏ô (> 3s) ‡∏Ñ‡∏ß‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß</div>';
           } else {
               analysisHtml += '<div class="alert alert-success">‚úÖ ‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° (‚â§ 3s)</div>';
           }
           
           // Recovery time analysis
           if (results.recoveryTime > results.cycleTime * 0.8) {
               analysisHtml += '<div class="alert alert-danger">‚ö†Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤ Recovery ‡∏ô‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (> 80% ‡∏Ç‡∏≠‡∏á Cycle time) ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</div>';
           } else if (results.recoveryTime > results.cycleTime * 0.6) {
               analysisHtml += '<div class="alert alert-warning">‚ö†Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤ Recovery ‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≤‡∏ô (> 60% ‡∏Ç‡∏≠‡∏á Cycle time)</div>';
           }
           
           // Pressure drop analysis
           if (results.pressureDrop > 80) {
               analysisHtml += '<div class="alert alert-danger">‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å (> 80 bar) ‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö Gate</div>';
           } else if (results.pressureDrop > 50) {
               analysisHtml += '<div class="alert alert-warning">‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á‡∏û‡∏≠‡∏™‡∏°‡∏Ñ‡∏ß‡∏£ (> 50 bar) ‡∏Ñ‡∏ß‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏Ç‡∏¢‡∏≤‡∏¢ Gate</div>';
           }
           
           // Quality recommendations
           analysisHtml += '<div style="margin-top: 20px;"><h5>üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞:</h5><ul style="text-align: left; margin: 10px 0;">';
           
           if (results.qualityIndex < 80) {
               if (results.pressureDrop > 50) {
                   analysisHtml += '<li>üîß ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î Gate ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Fan Gate ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô</li>';
               }
               if (results.fillingTime > 3) {
                   analysisHtml += '<li>‚ö° ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î‡πÄ‡∏õ‡πá‡∏ô ' + Math.ceil(parseFloat(document.getElementById('injectionSpeed').value) * 1.2) + ' mm/s</li>';
               }
               if (results.moldPressure < 30) {
                   analysisHtml += '<li>üìà ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î‡πÄ‡∏õ‡πá‡∏ô ' + Math.ceil(parseFloat(document.getElementById('injectionPressure').value) * 1.15) + ' bar</li>';
               }
               if (results.tempEfficiency < 80) {
                   const plasticType = document.getElementById('plasticType').value;
                   const optimalTemp = materialProperties[plasticType].temperatures[1];
                   analysisHtml += '<li>üå°Ô∏è ‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÉ‡∏´‡πâ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° (' + optimalTemp + '¬∞C)</li>';
               }
           } else {
               analysisHtml += '<li>‚úÖ ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ ‡∏Ñ‡∏ß‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°</li>';
               analysisHtml += '<li>üéØ ‡∏•‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û ‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤ Cycle ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</li>';
           }
           
           analysisHtml += '</ul></div>';
           container.innerHTML = analysisHtml;
       }

       // Update quality meter visualization
       function updateQualityMeter(qualityIndex) {
           const meter = document.getElementById('qualityMeter');
           const scoreElement = document.getElementById('qualityScore');
           
           let className = 'quality-poor';
           if (qualityIndex > 80) className = 'quality-excellent';
           else if (qualityIndex > 60) className = 'quality-good';
           
           meter.className = `quality-fill ${className}`;
           meter.style.width = qualityIndex + '%';
           scoreElement.textContent = qualityIndex.toFixed(1);
       }

       // Enhanced defect prediction
       function predictDefects(results) {
           const container = document.getElementById('defectPrediction');
           const defects = [];
           
           // Short shot prediction
           if (results.moldPressure < 25 || results.fillingTime > 4) {
               defects.push({
                   type: 'Short Shot (‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°)',
                   probability: results.moldPressure < 15 ? '‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å' : '‡∏™‡∏π‡∏á',
                   causes: ['‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÉ‡∏ô‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡πà‡∏≥', '‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ', '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ï‡πà‡∏≥'],
                   solutions: ['‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏â‡∏µ‡∏î', '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏â‡∏µ‡∏î', '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å', '‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î Gate']
               });
           }
           
           // Flash prediction
           if (results.moldPressure > 120) {
               defects.push({
                   type: 'Flash (‡∏Ñ‡∏£‡∏µ‡∏ö)',
                   probability: results.moldPressure > 150 ? '‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å' : '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á',
                   causes: ['‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ', '‡πÅ‡∏£‡∏á‡∏´‡∏ô‡∏µ‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠', '‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏∂‡∏Å‡∏´‡∏£‡∏≠'],
                   solutions: ['‡∏•‡∏î‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏â‡∏µ‡∏î', '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏£‡∏á‡∏´‡∏ô‡∏µ‡∏ö', '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå', '‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏â‡∏µ‡∏î']
               });
           }
           
           // Sink mark prediction
           const holdPressure = parseFloat(document.getElementById('holdPressure').value);
           const holdTime = parseFloat(document.getElementById('holdTime').value);
           const partWeight = parseFloat(document.getElementById('partWeight').value);
           
           if (holdPressure < 30 || holdTime < 3 || (partWeight > 50 && holdTime < 5)) {
               defects.push({
                   type: 'Sink Mark (‡∏£‡∏≠‡∏¢‡∏¢‡∏∏‡∏ö)',
                   probability: holdPressure < 20 ? '‡∏™‡∏π‡∏á' : '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á',
                   causes: ['‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏¢‡πâ‡∏≥‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠', '‡πÄ‡∏ß‡∏•‡∏≤‡∏¢‡πâ‡∏≥‡∏™‡∏±‡πâ‡∏ô', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠'],
                   solutions: ['‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏¢‡πâ‡∏≥', '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏¢‡πâ‡∏≥', '‡∏õ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô', '‡πÄ‡∏û‡∏¥‡πà‡∏° Gate']
               });
           }
           
           // Warpage prediction
           const coolingTime = parseFloat(document.getElementById('coolingTime').value);
           const moldTemp = parseFloat(document.getElementById('moldTemp').value);
           
           if (coolingTime < 15 || Math.abs(moldTemp - 60) > 15) {
               defects.push({
                   type: 'Warpage (‡∏Å‡∏≤‡∏£‡∏ö‡∏¥‡∏î‡∏á‡∏≠)',
                   probability: coolingTime < 10 ? '‡∏™‡∏π‡∏á' : '‡∏ï‡πà‡∏≥',
                   causes: ['‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏¢‡πá‡∏ô‡∏™‡∏±‡πâ‡∏ô', '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°', '‡∏Å‡∏≤‡∏£‡∏´‡∏î‡∏ï‡∏±‡∏ß‡πÑ‡∏°‡πà‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠'],
                   solutions: ['‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏¢‡πá‡∏ô', '‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå', '‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á Gate', '‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏¢‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠']
               });
           }
           
           // Burn marks prediction
           const avgTemp = (parseFloat(document.getElementById('tempH1').value) + 
                          parseFloat(document.getElementById('tempH2').value)) / 2;
           const plasticType = document.getElementById('plasticType').value;
           const maxTemp = materialProperties[plasticType].temperatures[1] + 30;
           
           if (avgTemp > maxTemp || results.fillingTime < 1) {
               defects.push({
                   type: 'Burn Marks (‡∏£‡∏≠‡∏¢‡πÑ‡∏´‡∏°‡πâ)',
                   probability: avgTemp > maxTemp + 20 ? '‡∏™‡∏π‡∏á' : '‡∏ï‡πà‡∏≥',
                   causes: ['‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ', '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏â‡∏µ‡∏î‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å', '‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏ï‡∏¥‡∏î‡πÉ‡∏ô‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå'],
                   solutions: ['‡∏•‡∏î‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥', '‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏â‡∏µ‡∏î', '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏≠‡∏≤‡∏Å‡∏≤‡∏®', '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•‡∏Ç‡∏≠‡∏á‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å']
               });
           }
           
           // Display defect predictions
           let html = '<h4>üîÆ ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á</h4>';
           
           if (defects.length === 0) {
               html += '<div class="alert alert-success">‚úÖ ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</div>';
           } else {
               defects.forEach(defect => {
                   const alertClass = defect.probability.includes('‡∏™‡∏π‡∏á') ? 'alert-danger' : 
                                    defect.probability === '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á' ? 'alert-warning' : 'alert-info';
                   
                   html += `
                       <div class="defect-prediction ${alertClass}">
                           <h5>‚ö†Ô∏è ${defect.type}</h5>
                           <p><strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ:</strong> ${defect.probability}</p>
                           <p><strong>‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ:</strong> ${defect.causes.join(', ')}</p>
                           <p><strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong></p>
                           <ul>${defect.solutions.map(sol => `<li>${sol}</li>`).join('')}</ul>
                       </div>
                   `;
               });
           }
           
           container.innerHTML = html;
       }

       // Machine animation functions
       function startMachineAnimation() {
           const phases = ['‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°', '‡∏õ‡∏¥‡∏î‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå', '‡∏â‡∏µ‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å', '‡∏¢‡πâ‡∏≥‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô', '‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏¢‡πá‡∏ô', '‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå', '‡∏î‡∏±‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å'];
           let currentPhase = 0;
           const statusElement = document.getElementById('machineStatus');
           const animationElement = document.getElementById('injectionPhase');
           
           if (machineAnimationInterval) clearInterval(machineAnimationInterval);
           
           machineAnimationInterval = setInterval(() => {
               statusElement.textContent = phases[currentPhase];
               
               // Visual effects for different phases
               switch(currentPhase) {
                   case 0: // Prepare
                       animationElement.style.opacity = '0.1';
                       animationElement.style.transform = 'scale(1)';
                       break;
                   case 1: // Close mold
                       animationElement.style.opacity = '0.3';
                       animationElement.style.transform = 'scale(1.05)';
                       break;
                   case 2: // Injection
                       animationElement.style.opacity = '0.8';
                       animationElement.style.transform = 'scale(1.1)';
                       animationElement.style.background = '#667eea';
                       break;
                   case 3: // Hold pressure
                       animationElement.style.opacity = '0.9';
                       animationElement.style.background = '#38a169';
                       break;
                   case 4: // Cooling
                       animationElement.style.background = '#3182ce';
                       animationElement.style.transform = 'scale(1.05)';
                       break;
                   case 5: // Open mold
                       animationElement.style.opacity = '0.5';
                       animationElement.style.transform = 'scale(1)';
                       break;
                   case 6: // Eject
                       animationElement.style.opacity = '0.2';
                       animationElement.style.background = '#ed8936';
                       break;
               }
               
               currentPhase = (currentPhase + 1) % phases.length;
           }, 1500);
           
           logMessage('‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á', 'info');
       }

       function stopMachineAnimation() {
           if (machineAnimationInterval) {
               clearInterval(machineAnimationInterval);
               machineAnimationInterval = null;
               document.getElementById('machineStatus').textContent = '‡∏´‡∏¢‡∏∏‡∏î';
               document.getElementById('injectionPhase').style.opacity = '0.1';
               document.getElementById('injectionPhase').style.transform = 'scale(1)';
               logMessage('‡∏´‡∏¢‡∏∏‡∏î‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á', 'warning');
           }
       }

       // Comparison functions
       function captureCurrentResults() {
           const results = performCalculations();
           if (!results) {
               showAlert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•', 'danger');
               return;
           }
           
           const timestamp = new Date().toLocaleString('th-TH');
           const plasticType = document.getElementById('plasticType').value;
           const machineSize = document.getElementById('machineSize').value;
           const partWeight = document.getElementById('partWeight').value;
           
           const comparisonEntry = {
               id: Date.now(),
               timestamp: timestamp,
               description: `${plasticType} - ${machineSize}‡∏ï‡∏±‡∏ô - ${partWeight}g`,
               results: results,
               parameters: {
                   plasticType: plasticType,
                   machineSize: machineSize,
                   partWeight: partWeight,
                   injectionPressure: document.getElementById('injectionPressure').value,
                   injectionSpeed: document.getElementById('injectionSpeed').value,
                   holdPressure: document.getElementById('holdPressure').value,
                   coolingTime: document.getElementById('coolingTime').value
               }
           };
           
           comparisonData.push(comparisonEntry);
           updateComparisonDisplay();
           
           showAlert(`‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (${comparisonEntry.description})`, 'success');
           logMessage(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö: ${comparisonEntry.description}`, 'info');
       }

       function updateComparisonDisplay() {
           const container = document.getElementById('comparisonPanel');
           
           if (comparisonData.length === 0) {
               container.innerHTML = '<p style="text-align: center; color: #666;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö<br>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏•‡∏¥‡∏Å "üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</p>';
               return;
           }
           
           let html = '<div style="overflow-x: auto;"><table style="width: 100%; border-collapse: collapse; margin-top: 10px;">';
           html += '<thead><tr style="background: #f8f9fa;"><th style="padding: 10px; border: 1px solid #dee2e6;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>';
           
           comparisonData.forEach((entry, index) => {
               html += `<th style="padding: 10px; border: 1px solid #dee2e6; min-width: 120px;">
                   ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö ${index + 1}<br>
                   <small style="font-weight: normal;">${entry.description}</small><br>
                   <small style="font-weight: normal; color: #666;">${entry.timestamp}</small>
                   <br><button onclick="removeComparison(${entry.id})" style="background: #f56565; color: white; border: none; padding: 2px 6px; border-radius: 3px; font-size: 10px; margin-top: 5px;">‡∏•‡∏ö</button>
               </th>`;
           });
           
           html += '</tr></thead><tbody>';
           
           const comparisonFields = [
               { key: 'qualityIndex', label: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û (%)', unit: '%' },
               { key: 'flowRate', label: '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•', unit: 'cm¬≥/s' },
               { key: 'moldPressure', label: '‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÉ‡∏ô‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå', unit: 'bar' },
               { key: 'fillingTime', label: '‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°', unit: 's' },
               { key: 'cycleTime', label: '‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï', unit: 's' },
               { key: 'hourlyProduction', label: '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï', unit: '‡∏ä‡∏¥‡πâ‡∏ô/‡∏ä‡∏°.' },
               { key: 'energyPerCycle', label: '‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡∏£‡∏≠‡∏ö', unit: 'kWh' }
           ];
           
           comparisonFields.forEach(field => {
               html += `<tr><td style="padding: 8px; border: 1px solid #dee2e6; font-weight: bold;">${field.label}</td>`;
               
               comparisonData.forEach(entry => {
                   const value = entry.results[field.key];
                   let colorClass = '';
                   
                   // Color coding based on field type
                   if (field.key === 'qualityIndex') {
                       colorClass = value > 80 ? 'color: #38a169' : value > 60 ? 'color: #ed8936' : 'color: #e53e3e';
                   } else if (field.key === 'hourlyProduction') {
                       const maxProduction = Math.max(...comparisonData.map(e => e.results.hourlyProduction));
                       colorClass = value === maxProduction ? 'color: #38a169; font-weight: bold;' : '';
                   }
                   
                   html += `<td style="padding: 8px; border: 1px solid #dee2e6; text-align: center; ${colorClass}">
                       ${typeof value === 'number' ? value.toFixed(field.key === 'energyPerCycle' ? 3 : field.key === 'hourlyProduction' ? 0 : 2) : value} ${field.unit}
                   </td>`;
               });
               
               html += '</tr>';
           });
           
           html += '</tbody></table></div>';
           
           // Add comparison analysis
           if (comparisonData.length > 1) {
               html += '<div style="margin-top: 20px;"><h5>üìä ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</h5>';
               
               const bestQuality = comparisonData.reduce((prev, curr) => 
                   prev.results.qualityIndex > curr.results.qualityIndex ? prev : curr);
               const bestProduction = comparisonData.reduce((prev, curr) => 
                   prev.results.hourlyProduction > curr.results.hourlyProduction ? prev : curr);
               const bestEnergy = comparisonData.reduce((prev, curr) => 
                   prev.results.energyPerCycle < curr.results.energyPerCycle ? prev : curr);
               
               html += `
                   <div class="alert alert-info">
                       <strong>üèÜ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö:</strong><br>
                       <strong>‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î:</strong> ${bestQuality.description} (${bestQuality.results.qualityIndex.toFixed(1)}%)<br>
                       <strong>‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î:</strong> ${bestProduction.description} (${bestProduction.results.hourlyProduction} ‡∏ä‡∏¥‡πâ‡∏ô/‡∏ä‡∏°.)<br>
                       <strong>‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î:</strong> ${bestEnergy.description} (${bestEnergy.results.energyPerCycle.toFixed(3)} kWh/‡∏£‡∏≠‡∏ö)
                   </div>
               `;
           }
           
           container.innerHTML = html;
       }

       function removeComparison(id) {
           comparisonData = comparisonData.filter(entry => entry.id !== id);
           updateComparisonDisplay();
           logMessage('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö', 'warning');
       }

       function clearComparisons() {
           if (comparisonData.length === 0) return;
           
           if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
               comparisonData = [];
               updateComparisonDisplay();
               showAlert('üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'warning');
               logMessage('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', 'warning');
           }
       }

       // Cost analysis functions
       function calculateCostAnalysis() {
           const results = performCalculations();
           if (!results) {
               showAlert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô', 'danger');
               return;
           }
           
           const partWeight = parseFloat(document.getElementById('partWeight').value) || 0;
           const runnerWeight = parseFloat(document.getElementById('runnerWeight').value) || 0;
           const plasticType = document.getElementById('plasticType').value;
           const machineSize = document.getElementById('machineSize').value;
           
           // Material costs
           const materialCostPerKg = materialProperties[plasticType].cost;
           const totalWeight = (partWeight + runnerWeight) / 1000; // Convert to kg
           const materialCostPerPart = totalWeight * materialCostPerKg;
           
           // Energy costs
           const energyCostPerKwh = 4; // THB per kWh
           const energyCostPerPart = results.energyPerCycle * energyCostPerKwh;
           
           // Labor costs
           const specs = machineSpecs[machineSize];
           const laborCostPerHour = specs.hourlyRate;
           const laborCostPerPart = laborCostPerHour / results.hourlyProduction;
           
           // Machine depreciation
           const machineCostEstimate = machineSize * 50000; // Rough estimate in THB
           const depreciationYears = 10;
           const operatingHoursPerYear = 4000;
           const depreciationPerHour = machineCostEstimate / (depreciationYears * operatingHoursPerYear);
           const depreciationPerPart = depreciationPerHour / results.hourlyProduction;
           
           // Total costs
           const totalCostPerPart = materialCostPerPart + energyCostPerPart + laborCostPerPart + depreciationPerPart;
           const dailyProduction = results.hourlyProduction * 16; // 16 hours operation
           const dailyRevenue = dailyProduction * totalCostPerPart * 1.3; // Assume 30% markup
           const monthlyProfit = (dailyRevenue - (dailyProduction * totalCostPerPart)) * 25; // 25 working days
           
           // Waste analysis
           const wastePercentage = (runnerWeight / (partWeight + runnerWeight)) * 100;
           const recyclableValue = runnerWeight / 1000 * materialCostPerKg * 0.6; // 60% of original value
           
           displayCostAnalysis({
               materialCost: materialCostPerPart,
               energyCost: energyCostPerPart,
               laborCost: laborCostPerPart,
               depreciationCost: depreciationPerPart,
               totalCost: totalCostPerPart,
               dailyProduction: dailyProduction,
               dailyRevenue: dailyRevenue,
               monthlyProfit: monthlyProfit,
               wastePercentage: wastePercentage,
               recyclableValue: recyclableValue,
               breakEvenUnits: Math.ceil(machineCostEstimate / (totalCostPerPart * 0.3)) // Break-even analysis
           });
           
           calculateEnvironmentalImpact(results, totalWeight, wastePercentage);
           
           logMessage('‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô', 'success');
       }

       function displayCostAnalysis(costData) {
           const container = document.getElementById('costAnalysis');
           
           container.innerHTML = `
               <h4>üí∞ ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</h4>
               <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
                   <div style="background: white; padding: 15px; border-radius: 8px;">
                       <h5>üìä ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô</h5>
                       <div class="cost-item">
                           <span>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö:</span>
                           <strong>${costData.materialCost.toFixed(2)} ‡∏ø</strong>
                       </div>
                       <div class="cost-item">
                           <span>‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ü‡πâ‡∏≤:</span>
                           <strong>${costData.energyCost.toFixed(2)} ‡∏ø</strong>
                       </div>
                       <div class="cost-item">
                           <span>‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô:</span>
                           <strong>${costData.laborCost.toFixed(2)} ‡∏ø</strong>
                       </div>
                       <div class="cost-item">
                           <span>‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤:</span>
                           <strong>${costData.depreciationCost.toFixed(2)} ‡∏ø</strong>
                       </div>
                       <div class="cost-item" style="border-top: 2px solid #667eea; margin-top: 10px; padding-top: 10px;">
                           <span><strong>‡∏£‡∏ß‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô:</strong></span>
                           <strong style="color: #e53e3e; font-size: 1.2em;">${costData.totalCost.toFixed(2)} ‡∏ø</strong>
                       </div>
                   </div>
                   
                   <div style="background: white; padding: 15px; border-radius: 8px;">
                       <h5>üìà ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</h5>
                       <div class="cost-item">
                           <span>‡∏ú‡∏•‡∏¥‡∏ï‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô:</span>
                           <strong>${costData.dailyProduction.toFixed(0)} ‡∏ä‡∏¥‡πâ‡∏ô</strong>
                       </div>
                       <div class="cost-item">
                           <span>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô:</span>
                           <strong>${costData.dailyRevenue.toFixed(0)} ‡∏ø</strong>
                       </div>
                       <div class="cost-item">
                           <span>‡∏Å‡∏≥‡πÑ‡∏£‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</span>
                           <strong style="color: #38a169;">${costData.monthlyProfit.toFixed(0)} ‡∏ø</strong>
                       </div>
                       <div class="cost-item">
                           <span>‡∏à‡∏∏‡∏î‡∏Ñ‡∏∏‡πâ‡∏°‡∏ó‡∏∏‡∏ô:</span>
                           <strong>${costData.breakEvenUnits.toLocaleString()} ‡∏ä‡∏¥‡πâ‡∏ô</strong>
                       </div>
                   </div>
               </div>
               
               <div style="background: white; padding: 15px; border-radius: 8px; margin-top: 15px;">
                   <h5>‚ôªÔ∏è ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢</h5>
                   <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                       <div>
                           <strong>‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢:</strong> ${costData.wastePercentage.toFixed(1)}%<br>
                           <strong>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•‡πÑ‡∏î‡πâ:</strong> ${costData.recyclableValue.toFixed(2)} ‡∏ø/‡∏ä‡∏¥‡πâ‡∏ô
                       </div>
                       <div>
                           <strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong><br>
                           ${costData.wastePercentage > 25 ? 
                               '<span style="color: #e53e3e;">‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏™‡∏π‡∏á ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö Runner</span>' : 
                               '<span style="color: #38a169;">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ</span>'}
                       </div>
                   </div>
               </div>
           `;
       }

       function calculateEnvironmentalImpact(results, totalWeight, wastePercentage) {
           const container = document.getElementById('environmentalImpact');
           
           // CO2 emissions calculation
           const co2PerKwh = 0.5; // kg CO2 per kWh for Thailand
           const dailyCO2 = results.dailyEnergy * co2PerKwh;
           const monthlyCO2 = dailyCO2 * 25; // 25 working days
           
           // Water usage (estimated)
           const waterPerKg = 15; // liters per kg of plastic
           const dailyWater = results.hourlyProduction * 16 * totalWeight * waterPerKg;
           
           // Recyclability score
           const plasticType = document.getElementById('plasticType').value;
           const recyclabilityScores = {
               'ABS': 70, 'PP': 90, 'PE': 95, 'PS': 80, 
               'PC': 60, 'PA': 40, 'POM': 30, 'PMMA': 50
           };
           const recyclabilityScore = recyclabilityScores[plasticType] || 60;
           
           // Environmental score calculation
           let envScore = 100;
           envScore -= Math.min(dailyCO2 * 2, 30); // CO2 impact
           envScore -= Math.min(wastePercentage, 25); // Waste impact
           envScore += (recyclabilityScore - 50) / 2; // Recyclability bonus/penalty
           envScore = Math.max(Math.min(envScore, 100), 0);
           
           container.innerHTML = `
               <h4>üå± ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°</h4>
               <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                   <div style="background: white; padding: 15px; border-radius: 8px;">
                       <h5>üåç ‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡πà‡∏≠‡∏¢ CO‚ÇÇ</h5>
                       <strong>‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô:</strong> ${dailyCO2.toFixed(2)} kg<br>
                       <strong>‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</strong> ${monthlyCO2.toFixed(2)} kg<br>
                       <small style="color: #666;">‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ ${(monthlyCO2 * 4.6).toFixed(0)} ‡∏Å‡∏°.</small>
                   </div>
                   
                   <div style="background: white; padding: 15px; border-radius: 8px;">
                       <h5>üíß ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ô‡πâ‡∏≥</h5>
                       <strong>‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô:</strong> ${dailyWater.toFixed(0)} ‡∏•‡∏¥‡∏ï‡∏£<br>
                       <strong>‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô:</strong> ${(dailyWater / (results.hourlyProduction * 16)).toFixed(2)} ‡∏•‡∏¥‡∏ï‡∏£
                   </div>
                   
                   <div style="background: white; padding: 15px; border-radius: 8px;">
                       <h5>‚ôªÔ∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•</h5>
                       <strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</strong> ${recyclabilityScore}/100<br>
                       <strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</strong> ${plasticType}<br>
                       <small style="color: ${recyclabilityScore > 70 ? '#38a169' : recyclabilityScore > 50 ? '#ed8936' : '#e53e3e'};">
                           ${recyclabilityScore > 70 ? '‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•‡πÑ‡∏î‡πâ‡∏î‡∏µ' : recyclabilityScore > 50 ? '‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•‡πÑ‡∏î‡πâ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á' : '‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•‡πÑ‡∏î‡πâ‡∏¢‡∏≤‡∏Å'}
                       </small>
                   </div>
               </div>
               
               <div style="background: white; padding: 15px; border-radius: 8px; margin-top: 15px;">
                   <h5>üìä ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡∏£‡∏ß‡∏°</h5>
                   <div class="quality-meter">
                       <div class="quality-fill ${envScore > 70 ? 'quality-excellent' : envScore > 50 ? 'quality-good' : 'quality-poor'}" 
                            style="width: ${envScore}%"></div>
                   </div>
                   <div style="text-align: center; margin-top: 10px;">
                       <strong>${envScore.toFixed(1)}/100</strong> - 
                       <span style="color: ${envScore > 70 ? '#38a169' : envScore > 50 ? '#ed8936' : '#e53e3e'};">
                           ${envScore > 70 ? '‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏ï‡∏£‡∏ï‡πà‡∏≠‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°' : envScore > 50 ? '‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á' : '‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á'}
                       </span>
                   </div>
               </div>
               
               <div class="alert alert-info" style="margin-top: 15px;">
                   <strong>üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°:</strong><br>
                   ${envScore < 70 ? [
                       wastePercentage > 20 ? '‚Ä¢ ‡∏•‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö Runner' : '',
                       dailyCO2 > 15 ? '‚Ä¢ ‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï' : '',
                       recyclabilityScore < 60 ? '‚Ä¢ ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏µ‡πà‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤' : '',
                       '‚Ä¢ ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏™‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå',
                       '‚Ä¢ ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏¢‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡∏õ‡∏¥‡∏î (Closed-loop cooling)'
                   ].filter(tip => tip).join('<br>') : '‚Ä¢ ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ'}
               </div>
           `;
       }

       // Enhanced recommendations system
       function showRecommendations() {
           const results = performCalculations();
           if (!results) {
               showAlert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Ç‡∏≠‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥', 'danger');
               return;
           }
           
           const plasticType = document.getElementById('plasticType').value;
           const partWeight = parseFloat(document.getElementById('partWeight').value);
           const machineSize = document.getElementById('machineSize').value;
           
           let recommendations = `
           <div style="background: white; border-radius: 15px; padding: 20px; margin: 20px 0; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
               <h3 style="color: #667eea; margin-bottom: 20px;">üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
               
               <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                   <strong>üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô:</strong><br>
                   ‡∏ß‡∏±‡∏™‡∏î‡∏∏: ${plasticType} | ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á: ${machineSize} ‡∏ï‡∏±‡∏ô | ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô: ${partWeight} g
               </div>
           `;
           
           // Process optimization recommendations
           recommendations += '<h4>üîß ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£:</h4><ul>';
           
           if (results.qualityIndex < 80) {
               if (results.moldPressure < 30) {
                   recommendations += '<li><strong>‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô:</strong> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏â‡∏µ‡∏î‡πÄ‡∏õ‡πá‡∏ô ' + 
                       Math.ceil(parseFloat(document.getElementById('injectionPressure').value) * 1.15) + ' bar</li>';
               }
               if (results.fillingTime > 3) {
                   recommendations += '<li><strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß:</strong> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏â‡∏µ‡∏î‡πÄ‡∏õ‡πá‡∏ô ' + 
                       Math.ceil(parseFloat(document.getElementById('injectionSpeed').value) * 1.2) + ' mm/s</li>';
               }
               if (results.tempEfficiency < 80) {
                   recommendations += '<li><strong>‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥:</strong> ‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÉ‡∏´‡πâ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô</li>';
               }
           }
           
           // Material-specific recommendations
           const materialProps = materialProperties[plasticType];
           recommendations += `<li><strong>‡∏ß‡∏±‡∏™‡∏î‡∏∏ ${plasticType}:</strong> ${materialProps.applications}</li>`;
           recommendations += `<li><strong>‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°:</strong> ${materialProps.processWindow.temp}</li>`;
           recommendations += `<li><strong>‡∏ä‡πà‡∏ß‡∏á‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ${materialProps.processWindow.pressure}</li>`;
           
           recommendations += '</ul>';
           
           // Machine utilization
           const utilizationRate = (partWeight + parseFloat(document.getElementById('runnerWeight').value)) / machineSpecs[machineSize].maxShot * 100;
           recommendations += '<h4>üè≠ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£:</h4><ul>';
           recommendations += `<li><strong>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</strong> ${utilizationRate.toFixed(1)}% ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ</li>`;
           
           if (utilizationRate < 30) {
               recommendations += '<li><strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô</li>';
           } else if (utilizationRate > 80) {
               recommendations += '<li><strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏Å‡∏ß‡πà‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</li>';
           } else {
               recommendations += '<li><strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô</li>';
           }
           
           recommendations += '</ul>';
           
           // Cost optimization
           if (results.cycleTime > 30) {
               recommendations += '<h4>üí∞ ‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô:</h4><ul>';
               recommendations += '<li>‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤ Cycle ‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏¢‡πá‡∏ô</li>';
               recommendations += '<li>‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÉ‡∏ä‡πâ Hot Runner ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢</li>';
               recommendations += '</ul>';
           }
           
           // Quality improvement
           recommendations += '<h4>‚ú® ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û:</h4><ul>';
           if (results.qualityIndex > 85) {
              recommendations += '<li>‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° ‡∏Ñ‡∏ß‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏¥‡∏°</li>';
               recommendations += '<li>‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û</li>';
           } else {
               recommendations += '<li>‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö Gate ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô</li>';
               recommendations += '<li>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏¢‡πá‡∏ô‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠</li>';
               recommendations += '<li>‡∏õ‡∏£‡∏±‡∏ö Profile ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏™‡∏î‡∏∏</li>';
           }
           recommendations += '</ul>';
           
           // Safety considerations
           recommendations += '<h4>üõ°Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢:</h4><ul>';
           const injectionPressure = parseFloat(document.getElementById('injectionPressure').value);
           if (injectionPressure > 120) {
               recommendations += '<li>‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡πÅ‡∏£‡∏á‡∏´‡∏ô‡∏µ‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥</li>';
           }
           if (materialProps.temperatures[1] > 250) {
               recommendations += '<li>‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏™‡∏π‡∏á ‡πÉ‡∏ä‡πâ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</li>';
           }
           recommendations += '<li>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥</li>';
           recommendations += '</ul>';
           
           // Environmental considerations
           const wastePercent = (parseFloat(document.getElementById('runnerWeight').value) / 
               (parseFloat(document.getElementById('partWeight').value) + parseFloat(document.getElementById('runnerWeight').value))) * 100;
           
           if (wastePercent > 20) {
               recommendations += '<h4>üå± ‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°:</h4><ul>';
               recommendations += '<li>‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏™‡∏π‡∏á (>20%) ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö Runner ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ Hot Runner</li>';
               recommendations += '<li>‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏• Runner ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</li>';
               recommendations += '</ul>';
           }
           
           recommendations += '</div>';
           
           // Display recommendations in a modal-like alert
           const alertDiv = document.createElement('div');
           alertDiv.innerHTML = recommendations;
           alertDiv.style.position = 'fixed';
           alertDiv.style.top = '50%';
           alertDiv.style.left = '50%';
           alertDiv.style.transform = 'translate(-50%, -50%)';
           alertDiv.style.zIndex = '10000';
           alertDiv.style.maxWidth = '800px';
           alertDiv.style.maxHeight = '80vh';
           alertDiv.style.overflow = 'auto';
           alertDiv.style.backgroundColor = 'rgba(255,255,255,0.98)';
           alertDiv.style.borderRadius = '15px';
           alertDiv.style.boxShadow = '0 20px 40px rgba(0,0,0,0.3)';
           
           const closeButton = document.createElement('button');
           closeButton.innerHTML = '‚úï ‡∏õ‡∏¥‡∏î';
           closeButton.className = 'btn btn-danger';
           closeButton.style.position = 'absolute';
           closeButton.style.top = '10px';
           closeButton.style.right = '10px';
           closeButton.onclick = () => {
               document.body.removeChild(overlay);
               document.body.removeChild(alertDiv);
           };
           
           const overlay = document.createElement('div');
           overlay.style.position = 'fixed';
           overlay.style.top = '0';
           overlay.style.left = '0';
           overlay.style.width = '100%';
           overlay.style.height = '100%';
           overlay.style.backgroundColor = 'rgba(0,0,0,0.5)';
           overlay.style.zIndex = '9999';
           
           alertDiv.appendChild(closeButton);
           document.body.appendChild(overlay);
           document.body.appendChild(alertDiv);
           
           logMessage('‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï', 'info');
       }

       // Enhanced simulation functions
       function runFullSimulation() {
           if (!validateInputs()) {
               return;
           }
           
           showAlert('üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå...', 'info');
           logMessage('‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå', 'info');
           
           document.getElementById('loadingIndicator').style.display = 'block';
           
           // Simulate comprehensive analysis
           setTimeout(() => {
               const results = performCalculations();
               generateComprehensiveReport(results);
               document.getElementById('loadingIndicator').style.display = 'none';
               showAlert('‚úÖ ‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå! ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏ó‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•', 'success');
               logMessage('‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå', 'success');
               
               // Auto switch to report tab
               switchTab('report');
               document.querySelector('[onclick="switchTab(\'report\')"]').classList.add('active');
           }, 3000);
       }

       // Generate comprehensive report
       function generateComprehensiveReport(results) {
           const reportContainer = document.getElementById('simulationReport');
           
           const inputs = {
               machineSize: document.getElementById('machineSize').value,
               plasticType: document.getElementById('plasticType').value,
               gateType: document.getElementById('gateType').value,
               partWeight: document.getElementById('partWeight').value,
               runnerWeight: document.getElementById('runnerWeight').value,
               actualShotSize: document.getElementById('actualShotSize').value,
               tempHN: document.getElementById('tempHN').value,
               tempH1: document.getElementById('tempH1').value,
               tempH2: document.getElementById('tempH2').value,
               tempH3: document.getElementById('tempH3').value,
               moldTemp: document.getElementById('moldTemp').value,
               injectionPressure: document.getElementById('injectionPressure').value,
               injectionSpeed: document.getElementById('injectionSpeed').value,
               injectionTime: document.getElementById('injectionTime').value,
               holdPressure: document.getElementById('holdPressure').value,
               holdTime: document.getElementById('holdTime').value,
               coolingTime: document.getElementById('coolingTime').value
           };
           
           const plasticProps = materialProperties[inputs.plasticType];
           const machineSpecs = machineSpecs[inputs.machineSize];
           
           const reportHtml = `
               <div style="padding: 20px; background: white; border-radius: 10px;">
                   <div style="text-align: center; margin-bottom: 30px; border-bottom: 2px solid #667eea; padding-bottom: 20px;">
                       <h2 style="color: #667eea;">üìã ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°</h2>
                       <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${new Date().toLocaleDateString('th-TH', {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'})}</p>
                       <p><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${new Date().toLocaleTimeString('th-TH')}</p>
                       <p><strong>‡∏ú‡∏π‡πâ‡∏à‡∏≥‡∏•‡∏≠‡∏á:</strong> Enhanced Injection Molding Simulator v2.0</p>
                   </div>
                   
                   <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                       <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                           <h3 style="color: #495057; margin-bottom: 15px;">üîß ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏™‡∏î‡∏∏</h3>
                           <table style="width: 100%; font-size: 0.95em;">
                               <tr><td style="padding: 5px 0;"><strong>‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á:</strong></td><td>${inputs.machineSize} ‡∏ï‡∏±‡∏ô</td></tr>
                               <tr><td><strong>‡∏Ç‡∏ô‡∏≤‡∏î Screw:</strong></td><td>${machineSpecs.screwSize} mm</td></tr>
                               <tr><td><strong>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á:</strong></td><td>${machineSpecs.power} kW</td></tr>
                               <tr><td><strong>‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å:</strong></td><td>${inputs.plasticType}</td></tr>
                               <tr><td><strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô:</strong></td><td>${plasticProps.density} g/cm¬≥</td></tr>
                               <tr><td><strong>‡∏Å‡∏≤‡∏£‡∏´‡∏î‡∏ï‡∏±‡∏ß:</strong></td><td>${plasticProps.shrinkage}%</td></tr>
                               <tr><td><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó Gate:</strong></td><td>${inputs.gateType}</td></tr>
                               <tr><td><strong>‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</strong></td><td>${plasticProps.applications}</td></tr>
                           </table>
                       </div>
                       
                       <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                           <h3 style="color: #495057; margin-bottom: 15px;">üå°Ô∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</h3>
                           <table style="width: 100%; font-size: 0.95em;">
                               <tr><td style="padding: 5px 0;"><strong>Nozzle:</strong></td><td>${inputs.tempHN}¬∞C</td></tr>
                               <tr><td><strong>Zone 1:</strong></td><td>${inputs.tempH1}¬∞C</td></tr>
                               <tr><td><strong>Zone 2:</strong></td><td>${inputs.tempH2}¬∞C</td></tr>
                               <tr><td><strong>Zone 3:</strong></td><td>${inputs.tempH3}¬∞C</td></tr>
                               <tr><td><strong>‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå:</strong></td><td>${inputs.moldTemp}¬∞C</td></tr>
                               <tr><td><strong>‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢:</strong></td><td>${((parseFloat(inputs.tempH1) + parseFloat(inputs.tempH2) + parseFloat(inputs.tempH3))/3).toFixed(1)}¬∞C</td></tr>
                               <tr><td><strong>‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong></td><td>${plasticProps.processWindow.temp}</td></tr>
                               <tr><td><strong>‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û:</strong></td><td style="color: ${results.tempEfficiency > 80 ? '#28a745' : '#dc3545'}">${results.tempEfficiency.toFixed(1)}%</td></tr>
                           </table>
                       </div>
                   </div>
                   
                   <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                       <h3 style="color: #1565c0; margin-bottom: 15px;">üíâ ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î</h3>
                       <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                           <div>
                               <h4 style="color: #1976d2; margin-bottom: 10px;">‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î</h4>
                               <strong>‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô:</strong> ${inputs.injectionPressure} bar<br>
                               <strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß:</strong> ${inputs.injectionSpeed} mm/s<br>
                               <strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${inputs.injectionTime} s<br>
                               <strong>Shot Size:</strong> ${inputs.actualShotSize} mm
                           </div>
                           <div>
                               <h4 style="color: #1976d2; margin-bottom: 10px;">‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≥</h4>
                               <strong>‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô:</strong> ${inputs.holdPressure} bar<br>
                               <strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${inputs.holdTime} s<br>
                               <strong>Cushion:</strong> ${document.getElementById('cushion').value} mm<br>
                               <strong>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô:</strong> ${(parseFloat(inputs.holdPressure)/parseFloat(inputs.injectionPressure)*100).toFixed(1)}%
                           </div>
                           <div>
                               <h4 style="color: #1976d2; margin-bottom: 10px;">‡∏Å‡∏≤‡∏£‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏¢‡πá‡∏ô</h4>
                               <strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${inputs.coolingTime} s<br>
                               <strong>‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≠‡∏ö:</strong> ${results.cycleTime.toFixed(1)} s<br>
                               <strong>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ú‡∏•‡∏¥‡∏ï:</strong> ${results.hourlyProduction} ‡∏ä‡∏¥‡πâ‡∏ô/‡∏ä‡∏°.<br>
                               <strong>‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û:</strong> ${(3600/results.cycleTime/60*100).toFixed(1)}%
                           </div>
                       </div>
                   </div>
                   
                   <div style="background: #f3e5f5; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                       <h3 style="color: #7b1fa2; margin-bottom: 15px;">üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h3>
                       <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                           <div style="background: white; padding: 15px; border-radius: 8px;">
                               <h4 style="color: #8e24aa;">üåä ‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•‡πÅ‡∏•‡∏∞‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô</h4>
                               <strong>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•:</strong> ${results.flowRate.toFixed(2)} cm¬≥/s<br>
                               <strong>‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢:</strong> <span style="color: ${results.pressureDrop > 50 ? '#d32f2f' : '#388e3c'}">${results.pressureDrop.toFixed(2)} bar</span><br>
                               <strong>‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÉ‡∏ô‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå:</strong> <span style="color: ${results.moldPressure < 30 ? '#d32f2f' : '#388e3c'}">${results.moldPressure.toFixed(2)} bar</span><br>
                               <strong>‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°:</strong> <span style="color: ${results.fillingTime > 3 ? '#d32f2f' : '#388e3c'}">${results.fillingTime.toFixed(2)} s</span>
                           </div>
                           
                           <div style="background: white; padding: 15px; border-radius: 8px;">
                               <h4 style="color: #8e24aa;">‚ö° ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</h4>
                               <strong>‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≠‡∏ö:</strong> ${results.cycleTime.toFixed(1)} s<br>
                               <strong>‡∏ú‡∏•‡∏¥‡∏ï‡∏ï‡πà‡∏≠‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á:</strong> ${results.hourlyProduction} ‡∏ä‡∏¥‡πâ‡∏ô<br>
                               <strong>‡∏ú‡∏•‡∏¥‡∏ï‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô:</strong> ${(results.hourlyProduction * 16).toFixed(0)} ‡∏ä‡∏¥‡πâ‡∏ô<br>
                               <strong>‡πÄ‡∏ß‡∏•‡∏≤ Recovery:</strong> ${results.recoveryTime.toFixed(2)} s
                           </div>
                           
                           <div style="background: white; padding: 15px; border-radius: 8px;">
                               <h4 style="color: #8e24aa;">üèÜ ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</h4>
                               <strong>‡∏î‡∏±‡∏ä‡∏ô‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û:</strong> <span style="color: ${results.qualityIndex > 80 ? '#388e3c' : results.qualityIndex > 60 ? '#f57c00' : '#d32f2f'}; font-size: 1.2em;">${results.qualityIndex.toFixed(1)}%</span><br>
                               <strong>‡∏Å‡∏≤‡∏£‡∏´‡∏î‡∏ï‡∏±‡∏ß‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå:</strong> ${results.shrinkageAmount.toFixed(2)} g<br>
                               <strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏°‡∏¥‡∏ï‡∏¥:</strong> ${(100 - plasticProps.shrinkage * 1.2).toFixed(1)}%<br>
                               <strong>‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥:</strong> ${results.tempEfficiency.toFixed(1)}%
                           </div>
                       </div>
                   </div>
                   
                   <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                       <h3 style="color: #2e7d32; margin-bottom: 15px;">üí∞ ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô</h3>
                       ${generateCostSummary(results, inputs)}
                   </div>
                   
                   <div style="background: #fff3e0; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                       <h3 style="color: #f57c00; margin-bottom: 15px;">‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏∞‡πÅ‡∏ô‡∏∞</h3>
                       ${generateRiskAssessment(results, inputs)}
                   </div>
                   
                   <div style="background: #f1f8e9; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                       <h3 style="color: #558b2f; margin-bottom: 15px;">üå± ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°</h3>
                       ${generateEnvironmentalSummary(results, inputs)}
                   </div>
                   
                   <div style="background: #e1f5fe; padding: 20px; border-radius: 10px;">
                       <h3 style="color: #0277bd; margin-bottom: 15px;">üìà ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏∞‡πÅ‡∏ô‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</h3>
                       ${generateFinalRecommendations(results, inputs)}
                   </div>
               </div>
           `;
           
           reportContainer.innerHTML = reportHtml;
       }

       function generateCostSummary(results, inputs) {
           const partWeight = parseFloat(inputs.partWeight);
           const runnerWeight = parseFloat(inputs.runnerWeight);
           const plasticType = inputs.plasticType;
           const machineSize = inputs.machineSize;
           
           const materialCost = (partWeight + runnerWeight) / 1000 * materialProperties[plasticType].cost;
           const energyCost = results.energyPerCycle * 4; // 4 THB/kWh
           const laborCost = machineSpecs[machineSize].hourlyRate / results.hourlyProduction;
           const totalCost = materialCost + energyCost + laborCost;
           
           return `
               <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                   <div style="background: white; padding: 15px; border-radius: 8px;">
                       <h4 style="color: #2e7d32;">üíµ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô</h4>
                       <strong>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö:</strong> ${materialCost.toFixed(2)} ‡∏ø<br>
                       <strong>‡πÑ‡∏ü‡∏ü‡πâ‡∏≤:</strong> ${energyCost.toFixed(2)} ‡∏ø<br>
                       <strong>‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô:</strong> ${laborCost.toFixed(2)} ‡∏ø<br>
                       <hr><strong>‡∏£‡∏ß‡∏°:</strong> <span style="color: #d32f2f; font-size: 1.1em;">${totalCost.toFixed(2)} ‡∏ø</span>
                   </div>
                   <div style="background: white; padding: 15px; border-radius: 8px;">
                       <h4 style="color: #2e7d32;">üìä ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</h4>
                       <strong>‡∏ú‡∏•‡∏¥‡∏ï‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô:</strong> ${(results.hourlyProduction * 16).toFixed(0)} ‡∏ä‡∏¥‡πâ‡∏ô<br>
                       <strong>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô:</strong> ${(results.hourlyProduction * 16 * totalCost * 1.25).toFixed(0)} ‡∏ø<br>
                       <strong>‡∏Å‡∏≥‡πÑ‡∏£‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</strong> ${(results.hourlyProduction * 16 * totalCost * 0.25 * 25).toFixed(0)} ‡∏ø<br>
                       <strong>ROI:</strong> ${((totalCost * 0.25 / totalCost) * 100).toFixed(1)}%
                   </div>
               </div>
           `;
       }

       function generateRiskAssessment(results, inputs) {
           let risks = [];
           let recommendations = [];
           
           if (results.moldPressure < 25) {
               risks.push('üî¥ ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÉ‡∏ô‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡πà‡∏≥ - ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á Short Shot');
               recommendations.push('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏â‡∏µ‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î');
           }
           
           if (results.pressureDrop > 60) {
               risks.push('üü† ‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á - ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠');
               recommendations.push('‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö Gate ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏ô‡∏≤‡∏î Gate');
           }
           
           if (results.fillingTime > 4) {
               risks.push('üü° ‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡∏≤‡∏ô - ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ú‡∏¥‡∏ß');
               recommendations.push('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏â‡∏µ‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥');
           }
           
           if (parseFloat(inputs.injectionPressure) > 130) {
               risks.push('üî¥ ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å - ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏£‡∏µ‡∏ö‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢');
               recommendations.push('‡∏•‡∏î‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢');
           }
           
           return `
               <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                   <div>
                       <h4 style="color: #f57c00;">‚ö†Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏ö</h4>
                       ${risks.length > 0 ? risks.map(risk => `<div style="margin: 5px 0; padding: 8px; background: #fff3e0; border-left: 4px solid #ff9800; border-radius: 4px;">${risk}</div>`).join('') : '<div style="color: #4caf50;">‚úÖ ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</div>'}
                   </div>
                   <div>
                       <h4 style="color: #f57c00;">üí° ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏∞‡πÅ‡∏ô‡∏∞</h4>
                       ${recommendations.length > 0 ? recommendations.map(rec => `<div style="margin: 5px 0; padding: 8px; background: #e8f5e8; border-left: 4px solid #4caf50; border-radius: 4px;">‚Ä¢ ${rec}</div>`).join('') : '<div style="color: #4caf50;">‚úÖ ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏î‡∏µ</div>'}
                   </div>
               </div>
           `;
       }

       function generateEnvironmentalSummary(results, inputs) {
           const co2PerDay = results.dailyEnergy * 0.5;
           const wastePercent = (parseFloat(inputs.runnerWeight) / (parseFloat(inputs.partWeight) + parseFloat(inputs.runnerWeight))) * 100;
           const recyclability = {'ABS': 70, 'PP': 90, 'PE': 95, 'PS': 80, 'PC': 60, 'PA': 40, 'POM': 30, 'PMMA': 50}[inputs.plasticType];
           
           return `
               <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                   <div style="background: white; padding: 15px; border-radius: 8px;">
                       <h4 style="color: #558b2f;">üåç ‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡πà‡∏≠‡∏¢ CO‚ÇÇ</h4>
                       <strong>‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô:</strong> ${co2PerDay.toFixed(2)} kg<br>
                       <strong>‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</strong> ${(co2PerDay * 25).toFixed(2)} kg<br>
                       <strong>‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô:</strong> ${(co2PerDay / (results.hourlyProduction * 16) * 1000).toFixed(1)} g
                   </div>
                   <div style="background: white; padding: 15px; border-radius: 8px;">
                       <h4 style="color: #558b2f;">‚ôªÔ∏è ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢</h4>
                       <strong>‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢:</strong> ${wastePercent.toFixed(1)}%<br>
                       <strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•:</strong> ${recyclability}%<br>
                       <strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å:</strong> ${inputs.plasticType}
                   </div>
                   <div style="background: white; padding: 15px; border-radius: 8px;">
                       <h4 style="color: #558b2f;">üìä ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°</h4>
                       <div style="background: #e0e0e0; border-radius: 10px; height: 20px; position: relative; margin: 10px 0;">
                           <div style="background: ${recyclability > 70 ? '#4caf50' : recyclability > 50 ? '#ff9800' : '#f44336'}; height: 100%; width: ${recyclability}%; border-radius: 10px;"></div>
                       </div>
                       <strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</strong> ${recyclability}/100
                   </div>
               </div>
           `;
       }

       function generateFinalRecommendations(results, inputs) {
           let recommendations = '';
           
           if (results.qualityIndex >= 85) {
               recommendations += `
                   <div class="alert alert-success">
                       <strong>üéØ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: EXCELLENT</strong><br>
                       ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                   </div>
                   <h4>üöÄ ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏∞‡πÅ‡∏ô‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï:</h4>
                   <ul>
                       <li>‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏¥‡∏°‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô Profile ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï</li>
                       <li>‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÅ‡∏ö‡∏ö Real-time</li>
                       <li>‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û</li>
                       <li>‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö Preventive Maintenance ‡∏ï‡∏≤‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£</li>
                   </ul>
               `;
           } else if (results.qualityIndex >= 70) {
               recommendations += `
                   <div class="alert alert-warning">
                       <strong>‚ö†Ô∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: GOOD</strong><br>
                       ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô
                   </div>
                   <h4>üîß ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏∞‡πÅ‡∏ô‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á:</h4>
                   <ul>
                       <li>‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏â‡∏µ‡∏î‡πÄ‡∏õ‡πá‡∏ô ${Math.ceil(parseFloat(inputs.injectionPressure) * 1.1)} bar</li>
                     <li>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏â‡∏µ‡∏î‡πÄ‡∏õ‡πá‡∏ô ${Math.ceil(parseFloat(inputs.injectionSpeed) * 1.15)} mm/s</li>
                       <li>‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÉ‡∏´‡πâ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô</li>
                       <li>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö Gate</li>
                       <li>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏à‡∏£‡∏¥‡∏á</li>
                   </ul>
               `;
           } else {
               recommendations += `
                   <div class="alert alert-danger">
                       <strong>üö´ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: NEEDS IMPROVEMENT</strong><br>
                       ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏à‡∏£‡∏¥‡∏á
                   </div>
                   <h4>üõ†Ô∏è ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏∞‡πÅ‡∏ô‡∏∞‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô:</h4>
                   <ul>
                       <li><strong>‡∏ó‡∏±‡∏ô‡∏ó‡∏µ:</strong> ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏â‡∏µ‡∏î‡πÄ‡∏õ‡πá‡∏ô ${Math.ceil(parseFloat(inputs.injectionPressure) * 1.2)} bar</li>
                       <li><strong>‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:</strong> ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö Gate ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó Gate</li>
                       <li><strong>‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô:</strong> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°</li>
                       <li><strong>‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï</li>
                       <li><strong>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á:</strong> ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å</li>
                   </ul>
               `;
           }
           
           // Add production checklist
           recommendations += `
               <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px;">
                   <h4>üìã Checklist ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï:</h4>
                   <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                       <div>
                           <strong>üîß ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£:</strong><br>
                           ‚òê ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÑ‡∏Æ‡∏î‡∏£‡∏≠‡∏•‡∏¥‡∏Å<br>
                           ‚òê ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î Screw ‡πÅ‡∏•‡∏∞ Barrel<br>
                           ‚òê ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥<br>
                           ‚òê ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢<br>
                           ‚òê ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏£‡∏á‡∏´‡∏ô‡∏µ‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
                       </div>
                       <div>
                           <strong>üè≠ ‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå:</strong><br>
                           ‚òê ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå<br>
                           ‚òê ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏¢‡πá‡∏ô<br>
                           ‚òê ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå<br>
                           ‚òê ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Gate ‡πÅ‡∏•‡∏∞ Ejector<br>
                           ‚òê ‡∏ß‡∏±‡∏î‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå
                       </div>
                       <div>
                           <strong>üî¨ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö:</strong><br>
                           ‚òê ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏°‡πá‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å<br>
                           ‚òê ‡∏≠‡∏ö‡πÅ‡∏´‡πâ‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î<br>
                           ‚òê ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏µ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÄ‡∏°‡πá‡∏î<br>
                           ‚òê ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏™‡∏≥‡∏£‡∏≠‡∏á<br>
                           ‚òê ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç Lot
                       </div>
                   </div>
               </div>
               
               <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-top: 15px;">
                   <h4>üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï (‡∏ï‡∏≤‡∏° Setting ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô):</h4>
                   <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                       <div><strong>‡∏ú‡∏•‡∏¥‡∏ï‡∏ï‡πà‡∏≠‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á:</strong> ${results.hourlyProduction} ‡∏ä‡∏¥‡πâ‡∏ô</div>
                       <div><strong>‡∏ú‡∏•‡∏¥‡∏ï‡∏ï‡πà‡∏≠‡∏Å‡∏∞ (8 ‡∏ä‡∏°.):</strong> ${(results.hourlyProduction * 8).toFixed(0)} ‡∏ä‡∏¥‡πâ‡∏ô</div>
                       <div><strong>‡∏ú‡∏•‡∏¥‡∏ï‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô (16 ‡∏ä‡∏°.):</strong> ${(results.hourlyProduction * 16).toFixed(0)} ‡∏ä‡∏¥‡πâ‡∏ô</div>
                       <div><strong>‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≠‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:</strong> ${results.cycleTime.toFixed(1)} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</div>
                   </div>
               </div>
           `;
           
           return recommendations;
       }

       // Process simulation functions
       function startProcessSimulation() {
           if (simulationRunning) return;
           
           simulationRunning = true;
           let progress = 0;
           const totalTime = 60; // 60 seconds simulation
           
           simulationInterval = setInterval(() => {
               progress += 1;
               const percentage = (progress / totalTime) * 100;
               
               document.getElementById('processProgress').style.width = percentage + '%';
               document.getElementById('progressText').textContent = percentage.toFixed(1) + '%';
               
               // Enhanced simulation phases with more detail
               if (progress === 3) logMessage('üî• ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô - ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ Zone 1: 180¬∞C', 'info');
               if (progress === 8) logMessage('üå°Ô∏è ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏´‡∏•‡∏≠‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'info');
               if (progress === 12) logMessage('üîÑ Screw ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏´‡∏°‡∏∏‡∏ô - ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å', 'info');
               if (progress === 18) logMessage('üí™ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏¥‡∏î‡πÅ‡∏°‡πà‡∏û‡∏¥ŸÖ‡∏û‡πå - ‡πÅ‡∏£‡∏á‡∏´‡∏ô‡∏µ‡∏ö 100%', 'info');
               if (progress === 22) logMessage('üíâ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î - ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô ' + document.getElementById('injectionPressure').value + ' bar', 'success');
               if (progress === 28) logMessage('üéØ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô - ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ï‡∏£ 100%', 'success');
               if (progress === 32) logMessage('üìê ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≥ - ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô ' + document.getElementById('holdPressure').value + ' bar', 'info');
               if (progress === 42) logMessage('‚ùÑÔ∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏¢‡πá‡∏ô - ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏•‡∏î‡∏•‡∏á', 'info');
               if (progress === 52) logMessage('üîì ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥', 'info');
               if (progress === 58) logMessage('üöÄ ‡∏î‡∏±‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å - ‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô', 'success');
               
               if (progress >= totalTime) {
                   clearInterval(simulationInterval);
                   simulationRunning = false;
                   logMessage('‚úÖ ‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå!', 'success');
                   showAlert('‚úÖ ‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô! ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå', 'success');
                   
                   // Auto-perform calculations after simulation
                   performCalculations();
               }
           }, 1000);
           
           logMessage('üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î', 'info');
       }

       function pauseSimulation() {
           if (simulationInterval) {
               clearInterval(simulationInterval);
               simulationRunning = false;
               logMessage('‚è∏Ô∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß', 'warning');
           }
       }

       function stopSimulation() {
           if (simulationInterval) {
               clearInterval(simulationInterval);
               simulationRunning = false;
               document.getElementById('processProgress').style.width = '0%';
               document.getElementById('progressText').textContent = '0%';
               logMessage('‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á - ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô', 'error');
           }
       }

       // Enhanced export functions
       function exportToPDF() {
           const reportContent = document.getElementById('simulationReport').innerHTML;
           if (!reportContent) {
               showAlert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏≤‡∏£ Export', 'danger');
               return;
           }
           
           const printWindow = window.open('', '_blank');
           printWindow.document.write(`
               <html>
                   <head>
                       <title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å</title>
                       <meta charset="UTF-8">
                       <style>
                           body { 
                               font-family: 'Sarabun', 'TH SarabunPSK', Arial, sans-serif; 
                               margin: 20px; 
                               line-height: 1.6;
                               color: #333;
                           }
                           table { 
                               border-collapse: collapse; 
                               width: 100%; 
                               margin: 10px 0; 
                           }
                           td, th { 
                               border: 1px solid #ddd; 
                               padding: 8px; 
                               text-align: left; 
                           }
                           .alert { 
                               padding: 10px; 
                               margin: 10px 0; 
                               border-radius: 5px; 
                           }
                           .alert-success { 
                               background: #d4edda; 
                               border: 1px solid #c3e6cb; 
                               color: #155724;
                           }
                           .alert-warning { 
                               background: #fff3cd; 
                               border: 1px solid #ffeaa7; 
                               color: #856404;
                           }
                           .alert-danger { 
                               background: #f8d7da; 
                               border: 1px solid #f5c6cb; 
                               color: #721c24;
                           }
                           h2, h3, h4 { 
                               color: #333; 
                               page-break-after: avoid;
                           }
                           .page-break { 
                               page-break-before: always; 
                           }
                           @media print { 
                               body { margin: 0; }
                               .no-print { display: none; }
                           }
                           @page {
                               margin: 2cm;
                               @bottom-right {
                                   content: "‡∏´‡∏ô‡πâ‡∏≤ " counter(page) " ‡∏à‡∏≤‡∏Å " counter(pages);
                               }
                           }
                       </style>
                   </head>
                   <body>
                       ${reportContent}
                       <div style="margin-top: 40px; text-align: center; font-size: 0.9em; color: #666;">
                           <hr>
                           <p>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢ Enhanced Injection Molding Simulator v2.0</p>
                           <p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô: ${new Date().toLocaleString('th-TH')}</p>
                       </div>
                   </body>
               </html>
           `);
           printWindow.document.close();
           
           // Wait a moment for content to load, then print
           setTimeout(() => {
               printWindow.print();
           }, 1000);
           
           logMessage('üìÑ Export PDF ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
           showAlert('üìÑ ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å PDF', 'info');
       }

       function exportToExcel() {
           const results = performCalculations();
           if (!results) {
               showAlert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏≤‡∏£ Export', 'danger');
               return;
           }
           
           const inputs = {
               machineSize: document.getElementById('machineSize').value,
               plasticType: document.getElementById('plasticType').value,
               gateType: document.getElementById('gateType').value,
               partWeight: document.getElementById('partWeight').value,
               runnerWeight: document.getElementById('runnerWeight').value,
               actualShotSize: document.getElementById('actualShotSize').value,
               injectionPressure: document.getElementById('injectionPressure').value,
               injectionSpeed: document.getElementById('injectionSpeed').value,
               injectionTime: document.getElementById('injectionTime').value,
               holdPressure: document.getElementById('holdPressure').value,
               holdTime: document.getElementById('holdTime').value,
               coolingTime: document.getElementById('coolingTime').value
           };
           
           // Create comprehensive CSV content
           const csvContent = `
Enhanced Injection Molding Simulation Report,,
Generated Date,${new Date().toLocaleDateString('th-TH')},
Generated Time,${new Date().toLocaleTimeString('th-TH')},
Software Version,v2.0,

MACHINE & MATERIAL SETTINGS,,
Machine Size,${inputs.machineSize},tons
Plastic Type,${inputs.plasticType},
Gate Type,${inputs.gateType},
Screw Size,${machineSpecs[inputs.machineSize].screwSize},mm
Max Shot Weight,${machineSpecs[inputs.machineSize].maxShot},g

PART SPECIFICATIONS,,
Part Weight,${inputs.partWeight},g
Runner Weight,${inputs.runnerWeight},g
Total Weight,${parseFloat(inputs.partWeight) + parseFloat(inputs.runnerWeight)},g
Shot Size,${inputs.actualShotSize},mm
Cushion,${document.getElementById('cushion').value},mm

TEMPERATURE SETTINGS,,
Nozzle Temperature,${document.getElementById('tempHN').value},¬∞C
Zone 1 Temperature,${document.getElementById('tempH1').value},¬∞C
Zone 2 Temperature,${document.getElementById('tempH2').value},¬∞C
Zone 3 Temperature,${document.getElementById('tempH3').value},¬∞C
Mold Temperature,${document.getElementById('moldTemp').value},¬∞C
Average Barrel Temp,${((parseFloat(document.getElementById('tempH1').value) + parseFloat(document.getElementById('tempH2').value) + parseFloat(document.getElementById('tempH3').value))/3).toFixed(1)},¬∞C

INJECTION PARAMETERS,,
Injection Pressure,${inputs.injectionPressure},bar
Injection Speed,${inputs.injectionSpeed},mm/s
Injection Time,${inputs.injectionTime},s
Hold Pressure,${inputs.holdPressure},bar
Hold Time,${inputs.holdTime},s
Cooling Time,${inputs.coolingTime},s
Hold Pressure Ratio,${(parseFloat(inputs.holdPressure)/parseFloat(inputs.injectionPressure)*100).toFixed(1)},%

CALCULATED RESULTS,,
Flow Rate,${results.flowRate.toFixed(2)},cm¬≥/s
Pressure Drop in Gate,${results.pressureDrop.toFixed(2)},bar
Mold Pressure,${results.moldPressure.toFixed(2)},bar
Filling Time,${results.fillingTime.toFixed(2)},s
Cycle Time,${results.cycleTime.toFixed(1)},s
Hourly Production,${results.hourlyProduction.toFixed(0)},pcs/hr
Daily Production,${(results.hourlyProduction * 16).toFixed(0)},pcs/day
Recovery Time,${results.recoveryTime.toFixed(2)},s
Energy per Cycle,${results.energyPerCycle.toFixed(3)},kWh
Daily Energy Consumption,${results.dailyEnergy.toFixed(2)},kWh
Temperature Efficiency,${results.tempEfficiency.toFixed(1)},%
Overall Quality Index,${results.qualityIndex.toFixed(1)},%

MATERIAL PROPERTIES,,
Density,${materialProperties[inputs.plasticType].density},g/cm¬≥
Shrinkage,${materialProperties[inputs.plasticType].shrinkage},%
Viscosity,${materialProperties[inputs.plasticType].viscosity},Pa¬∑s
Predicted Shrinkage,${results.shrinkageAmount.toFixed(2)},g
Process Window Temp,${materialProperties[inputs.plasticType].processWindow.temp},
Process Window Pressure,${materialProperties[inputs.plasticType].processWindow.pressure},

COST ANALYSIS,,
Material Cost per kg,${materialProperties[inputs.plasticType].cost},THB
Material Cost per Part,${((parseFloat(inputs.partWeight) + parseFloat(inputs.runnerWeight))/1000 * materialProperties[inputs.plasticType].cost).toFixed(2)},THB
Energy Cost per Part,${(results.energyPerCycle * 4).toFixed(2)},THB
Labor Cost per Part,${(machineSpecs[inputs.machineSize].hourlyRate / results.hourlyProduction).toFixed(2)},THB
Total Cost per Part,${((parseFloat(inputs.partWeight) + parseFloat(inputs.runnerWeight))/1000 * materialProperties[inputs.plasticType].cost + results.energyPerCycle * 4 + machineSpecs[inputs.machineSize].hourlyRate / results.hourlyProduction).toFixed(2)},THB

ENVIRONMENTAL IMPACT,,
CO2 Emission per Day,${(results.dailyEnergy * 0.5).toFixed(2)},kg
Waste Percentage,${((parseFloat(inputs.runnerWeight)/(parseFloat(inputs.partWeight) + parseFloat(inputs.runnerWeight)))*100).toFixed(1)},%
Recyclability Score,${{'ABS': 70, 'PP': 90, 'PE': 95, 'PS': 80, 'PC': 60, 'PA': 40, 'POM': 30, 'PMMA': 50}[inputs.plasticType]}/100,

QUALITY ASSESSMENT,,
Quality Status,${results.qualityIndex > 85 ? 'EXCELLENT' : results.qualityIndex > 70 ? 'GOOD' : 'NEEDS IMPROVEMENT'},
Recommended for Production,${results.qualityIndex > 70 ? 'YES' : 'NO WITH MODIFICATIONS'},
Key Risk Factors,${results.moldPressure < 25 ? 'Low Mold Pressure; ' : ''}${results.pressureDrop > 60 ? 'High Pressure Drop; ' : ''}${results.fillingTime > 4 ? 'Long Filling Time; ' : ''}${parseFloat(inputs.injectionPressure) > 130 ? 'Very High Pressure; ' : 'None'},

NOTES AND RECOMMENDATIONS,,
Primary Recommendation,${results.qualityIndex > 85 ? 'Maintain current settings' : results.qualityIndex > 70 ? 'Minor adjustments needed' : 'Major improvements required'},
Suggested Injection Pressure,${results.qualityIndex < 80 ? Math.ceil(parseFloat(inputs.injectionPressure) * 1.1) : inputs.injectionPressure},bar
Suggested Injection Speed,${results.qualityIndex < 80 ? Math.ceil(parseFloat(inputs.injectionSpeed) * 1.1) : inputs.injectionSpeed},mm/s
Machine Utilization,${((parseFloat(inputs.partWeight) + parseFloat(inputs.runnerWeight))/machineSpecs[inputs.machineSize].maxShot*100).toFixed(1)},%
           `.trim();
           
           // Create and download CSV file with enhanced filename
           const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
           const link = document.createElement('a');
           const url = URL.createObjectURL(blob);
           const filename = `Injection_Molding_Report_${inputs.plasticType}_${inputs.machineSize}T_${new Date().toISOString().slice(0,10)}_${new Date().toTimeString().slice(0,5).replace(':','')}.csv`;
           
           link.setAttribute('href', url);
           link.setAttribute('download', filename);
           link.style.visibility = 'hidden';
           document.body.appendChild(link);
           link.click();
           document.body.removeChild(link);
           
           logMessage(`üìó Export Excel: ${filename}`, 'success');
           showAlert('üìó Export Excel (CSV) ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‡πÑ‡∏ü‡∏•‡πå‡∏ñ‡∏π‡∏Å‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß', 'success');
       }

       // Reset all function with confirmation
       function resetAll() {
           if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö')) {
               // Reset all form inputs
               document.querySelectorAll('input[type="number"]').forEach(input => {
                   if (!input.readOnly) {
                       input.value = '';
                       input.classList.remove('error');
                   }
               });
               
               // Reset dropdowns to default
               document.getElementById('machineSize').value = '100';
               document.getElementById('plasticType').value = 'ABS';
               document.getElementById('gateType').value = 'Side Gate';
               
               // Clear results and analysis
               document.getElementById('calculationResults').innerHTML = '';
               document.getElementById('qualityAnalysis').innerHTML = '';
               document.getElementById('simulationReport').innerHTML = '';
               document.getElementById('defectPrediction').innerHTML = '';
               document.getElementById('costAnalysis').innerHTML = '';
               document.getElementById('environmentalImpact').innerHTML = '';
               
               // Reset quality meter
               document.getElementById('qualityMeter').style.width = '0%';
               document.getElementById('qualityScore').textContent = '0';
               
               // Reset progress
               document.getElementById('processProgress').style.width = '0%';
               document.getElementById('progressText').textContent = '0%';
               
               // Clear comparison data
               comparisonData = [];
               updateComparisonDisplay();
               
               // Reset phases
               currentPhases = 3;
               generatePhaseInputs();
               
               // Update machine info and plastic properties
               updateMachineInfo();
               updatePlasticProperties();
               
               // Clear profile selection
               document.getElementById('profileSelect').value = '';
               document.getElementById('profileName').value = '';
               
               // Stop any running simulations
               stopSimulation();
               stopMachineAnimation();
               
               logMessage('üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ - ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô', 'warning');
               showAlert('üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!\n\n‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà', 'warning');
               
               // Switch back to basic tab
               switchTab('basic');
               document.querySelector('[onclick="switchTab(\'basic\')"]').classList.add('active');
           }
       }

       // Utility functions
       function showAlert(message, type = 'info') {
           const existingAlerts = document.querySelectorAll('.temp-alert');
           existingAlerts.forEach(alert => alert.remove());
           
           const alertDiv = document.createElement('div');
           alertDiv.className = `alert alert-${type} temp-alert`;
           alertDiv.style.position = 'fixed';
           alertDiv.style.top = '20px';
           alertDiv.style.right = '20px';
           alertDiv.style.zIndex = '10000';
           alertDiv.style.maxWidth = '500px';
           alertDiv.style.animation = 'slideIn 0.3s ease-out';
           alertDiv.style.boxShadow = '0 10px 20px rgba(0,0,0,0.2)';
           alertDiv.innerHTML = message.replace(/\n/g, '<br>');
           
           document.body.appendChild(alertDiv);
           
           setTimeout(() => {
               if (alertDiv.parentNode) {
                   alertDiv.style.animation = 'slideOut 0.3s ease-in';
                   setTimeout(() => {
                       if (alertDiv.parentNode) {
                           alertDiv.remove();
                       }
                   }, 300);
               }
           }, 6000);
       }

       function logMessage(message, type = 'info') {
           const logContainer = document.getElementById('simulationLog');
           const timestamp = new Date().toLocaleTimeString('th-TH');
           const logEntry = document.createElement('div');
           logEntry.className = `log-entry ${type}`;
           logEntry.innerHTML = `[${timestamp}] ${message}`;
           
           logContainer.appendChild(logEntry);
           logContainer.scrollTop = logContainer.scrollHeight;
           
           // Keep only last 200 log entries for better performance
           const logEntries = logContainer.children;
           if (logEntries.length > 200) {
               logContainer.removeChild(logEntries[0]);
           }
       }

       function clearLog() {
           document.getElementById('simulationLog').innerHTML = '';
           logMessage('üìù ‡∏•‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà', 'info');
       }

       // Enhanced real-time input validation and auto-calculation
       document.addEventListener('input', function(e) {
           if (e.target.type === 'number') {
               const value = parseFloat(e.target.value);
               
               // Remove error class if value is valid
               if (value && value > 0) {
                   e.target.classList.remove('error');
               }
               
               // Auto-calculate dependent values
               if (['partWeight', 'runnerWeight'].includes(e.target.id)) {
                   calculateShotSize();
               }
               
               if (['holdTime', 'holdPressure', 'actualShotSize'].includes(e.target.id)) {
                   calculateCushion();
               }
               
               // Real-time calculation updates for analysis tab
               if (document.getElementById('analysis').classList.contains('active')) {
                   if (['injectionPressure', 'injectionSpeed', 'actualShotSize', 'viscosity', 'gateArea', 'flowLength', 'holdPressure', 'holdTime', 'coolingTime'].includes(e.target.id)) {
                       clearTimeout(window.calcTimeout);
                       window.calcTimeout = setTimeout(() => {
                           const results = performCalculations();
                           if (results) {
                               updateCalculationResults(results);
                               updateQualityAnalysis(results);
                               updateQualityMeter(results.qualityIndex);
                           }
                       }, 1000); // Debounce for 1 second
                   }
               }
           }
       });

       // Initialize all systems when DOM is ready
       document.addEventListener('DOMContentLoaded', function() {
           initializePhaseInputs();
           updateMachineInfo();
           updatePlasticProperties();
           loadProfileOptions();
           
           // Set initial values for better UX
           document.getElementById('partWeight').value = '25';
           document.getElementById('runnerWeight').value = '5';
           calculateShotSize();
           
           logMessage('üöÄ Enhanced Injection Molding Simulator v2.0 ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', 'success');
           logMessage('‚ú® ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà: ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå, ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö, ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô, ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°', 'info');
           
           // Show welcome message
           setTimeout(() => {
               showAlert('üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà Enhanced Injection Molding Simulator v2.0!\n\n‚ú® ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà:\n‚Ä¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå\n‚Ä¢ ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå\n‚Ä¢ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°\n‚Ä¢ ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏ö‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á\n‚Ä¢ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°', 'info');
           }, 1000);
       });

       // Auto-save functionality (save to localStorage every 2 minutes)
       setInterval(() => {
           const autoSaveData = {};
           document.querySelectorAll('input, select').forEach(input => {
               if (input.value && input.id) {
                   autoSaveData[input.id] = input.value;
               }
           });
           
           if (Object.keys(autoSaveData).length > 5) { // Only save if significant data exists
               localStorage.setItem('injectionMoldingAutoSave', JSON.stringify({
                   data: autoSaveData,
                   timestamp: new Date().toISOString()
               }));
           }
     }, 120000); // Every 2 minutes

       // Load auto-saved data on startup (if exists)
       const autoSavedData = localStorage.getItem('injectionMoldingAutoSave');
       if (autoSavedData) {
           try {
               const saved = JSON.parse(autoSavedData);
               const timeDiff = new Date() - new Date(saved.timestamp);
               
               // Only load if saved within last 24 hours
               if (timeDiff < 24 * 60 * 60 * 1000) {
                   setTimeout(() => {
                       if (confirm('‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥\n‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n' + 
                                  '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠: ' + new Date(saved.timestamp).toLocaleString('th-TH'))) {
                           Object.keys(saved.data).forEach(id => {
                               const element = document.getElementById(id);
                               if (element && element.value === '') {
                                   element.value = saved.data[id];
                               }
                           });
                           updateMachineInfo();
                           updatePlasticProperties();
                           calculateShotSize();
                           logMessage('üìÇ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥', 'info');
                       }
                   }, 2000);
               }
           } catch (e) {
               logMessage('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ', 'warning');
           }
       }

       // Keyboard shortcuts
       document.addEventListener('keydown', function(e) {
           // Ctrl+S: Save current profile
           if (e.ctrlKey && e.key === 's') {
               e.preventDefault();
               const profileName = prompt('‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå:');
               if (profileName) {
                   document.getElementById('profileName').value = profileName;
                   saveProfile();
               }
           }
           
           // Ctrl+R: Run simulation
           if (e.ctrlKey && e.key === 'r') {
               e.preventDefault();
               runFullSimulation();
           }
           
           // Ctrl+E: Export to Excel
           if (e.ctrlKey && e.key === 'e') {
               e.preventDefault();
               exportToExcel();
           }
           
           // F5: Validate inputs
           if (e.key === 'F5') {
               e.preventDefault();
               validateInputs();
           }
           
           // Ctrl+D: Clear all data
           if (e.ctrlKey && e.key === 'd') {
               e.preventDefault();
               resetAll();
           }
       });

       // Window resize handler for responsive design
       window.addEventListener('resize', function() {
           // Adjust chart container if needed
           const chartContainer = document.getElementById('processChart');
           if (chartContainer && window.innerWidth < 768) {
               chartContainer.style.height = '200px';
           } else if (chartContainer) {
               chartContainer.style.height = '300px';
           }
       });

       // Before unload warning if user has unsaved data
       window.addEventListener('beforeunload', function(e) {
           const hasData = document.getElementById('partWeight').value && 
                          document.getElementById('actualShotSize').value &&
                          document.getElementById('injectionPressure').value;
           
           if (hasData && !localStorage.getItem('injectionMoldingAutoSave')) {
               e.preventDefault();
               e.returnValue = '‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?';
               return '‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?';
           }
       });

       // Performance monitoring
       let performanceLog = [];
       
       function logPerformance(operation, startTime) {
           const endTime = performance.now();
           const duration = endTime - startTime;
           
           performanceLog.push({
               operation: operation,
               duration: duration,
               timestamp: new Date().toISOString()
           });
           
           // Keep only last 50 performance logs
           if (performanceLog.length > 50) {
               performanceLog.shift();
           }
           
           // Log slow operations
           if (duration > 1000) {
               logMessage(`‚ö° ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ "${operation}" ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ ${duration.toFixed(0)} ms`, 'warning');
           }
       }

       // Error handling and recovery
       window.addEventListener('error', function(e) {
           logMessage(`‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.message}`, 'error');
           console.error('Application Error:', e);
           
           // Try to recover gracefully
           try {
               // Reset any running intervals
               if (simulationInterval) clearInterval(simulationInterval);
               if (machineAnimationInterval) clearInterval(machineAnimationInterval);
               simulationRunning = false;
               
               showAlert('‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö\n‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥...', 'warning');
               
               setTimeout(() => {
                   showAlert('‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà', 'success');
               }, 2000);
               
           } catch (recoveryError) {
               showAlert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà', 'danger');
           }
       });

       // Service Worker registration for offline capability (if available)
       if ('serviceWorker' in navigator) {
           navigator.serviceWorker.register('/sw.js').then(function(registration) {
               logMessage('üîß Service Worker ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'info');
           }).catch(function(error) {
               // Silent fail - service worker is optional
           });
       }

       // Analytics and usage tracking (anonymized)
       const analytics = {
           sessionStart: new Date(),
           calculationsPerformed: 0,
           simulationsRun: 0,
           reportsGenerated: 0,
           profilesSaved: 0
       };
       
       function trackUsage(action) {
           analytics[action] = (analytics[action] || 0) + 1;
           
           // Log usage statistics every 10 actions
           const totalActions = Object.values(analytics).reduce((sum, val) => 
               typeof val === 'number' ? sum + val : sum, 0);
           
           if (totalActions > 0 && totalActions % 10 === 0) {
               logMessage(`üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ${analytics.calculationsPerformed || 0} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á, ‡∏à‡∏≥‡∏•‡∏≠‡∏á ${analytics.simulationsRun || 0} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`, 'info');
           }
       }

       // Override key functions to track usage
       const originalPerformCalculations = performCalculations;
       performCalculations = function(...args) {
           const startTime = performance.now();
           const result = originalPerformCalculations.apply(this, args);
           logPerformance('performCalculations', startTime);
           trackUsage('calculationsPerformed');
           return result;
       };

       const originalRunFullSimulation = runFullSimulation;
       runFullSimulation = function(...args) {
           const startTime = performance.now();
           const result = originalRunFullSimulation.apply(this, args);
           logPerformance('runFullSimulation', startTime);
           trackUsage('simulationsRun');
           return result;
       };

       const originalGenerateReport = generateReport;
       generateReport = function(...args) {
           const startTime = performance.now();
           const result = originalGenerateReport.apply(this, args);
           logPerformance('generateReport', startTime);
           trackUsage('reportsGenerated');
           return result;
       };

       const originalSaveProfile = saveProfile;
       saveProfile = function(...args) {
           const result = originalSaveProfile.apply(this, args);
           trackUsage('profilesSaved');
           return result;
       };

       // Final initialization message
       setTimeout(() => {
           logMessage('üéØ ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö - Enhanced Injection Molding Simulator v2.0', 'success');
           logMessage('üí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö: ‡πÉ‡∏ä‡πâ Ctrl+S ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå, Ctrl+R ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏•‡∏≠‡∏á', 'info');
           logMessage('üìö ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Tooltips (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ ?) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°', 'info');
       }, 3000);

   </script>
</body>
</html>